<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Tree Garden - ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡∏°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&family=Fredoka+One:wght@400&display=swap');
        
        * {
            font-family: 'Kanit', sans-serif;
        }
        
        .game-title {
            font-family: 'Fredoka One', cursive;
        }
        
        :root {
            --primary: #4CAF50;
            --secondary: #FFB74D;
            --accent: #FF6B6B;
            --sky: #87CEEB;
            --dark: #2E3440;
            --light: #F6F8FA;
            --highlight: #FFD700;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--sky) 0%, #B8E6B8 50%, var(--primary) 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .tree-3d {
            transform-style: preserve-3d;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.2));
        }
        
        .tree-3d:hover {
            transform: scale(1.1) rotateY(10deg) rotateX(5deg);
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(76, 175, 80, 0.3); }
            50% { box-shadow: 0 0 40px rgba(76, 175, 80, 0.6); }
        }
        
        .notification-slide {
            animation: slideInRight 0.5s ease-out;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .water-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        
        .water-drop {
            position: absolute;
            width: 12px;
            height: 16px;
            background: linear-gradient(135deg, #87CEEB 0%, #4682B4 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: waterDropFall 1.5s ease-out;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2), inset 0 1px 2px rgba(255,255,255,0.3);
        }
        
        @keyframes waterDropFall {
            0% { 
                transform: translateY(-100px) scale(0.5); 
                opacity: 0; 
            }
            20% { 
                opacity: 1; 
                transform: translateY(-50px) scale(0.8); 
            }
            80% { 
                transform: translateY(50px) scale(1); 
                opacity: 0.8; 
            }
            100% { 
                transform: translateY(100px) scale(1.2); 
                opacity: 0; 
            }
        }
        
        .rain-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        
        .rain-drop {
            position: absolute;
            width: 2px;
            height: 15px;
            background: linear-gradient(180deg, rgba(135, 206, 235, 0.8) 0%, rgba(70, 130, 180, 0.9) 100%);
            border-radius: 0 0 50% 50%;
            animation: rainDropFall 1s linear;
        }
        
        @keyframes rainDropFall {
            0% { 
                transform: translateY(-120px); 
                opacity: 0.8; 
            }
            100% { 
                transform: translateY(120px); 
                opacity: 0; 
            }
        }
        
        .fertilizer-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        
        .fertilizer-drop {
            position: absolute;
            width: 10px;
            height: 12px;
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #654321 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: fertilizerDropFall 1.8s ease-out;
            box-shadow: 0 2px 3px rgba(0,0,0,0.3);
        }
        
        @keyframes fertilizerDropFall {
            0% { 
                transform: translateY(-80px) scale(0.3); 
                opacity: 0; 
            }
            30% { 
                opacity: 1; 
                transform: translateY(-20px) scale(0.8); 
            }
            70% { 
                transform: translateY(40px) scale(1); 
                opacity: 0.9; 
            }
            100% { 
                transform: translateY(80px) scale(1.1); 
                opacity: 0; 
            }
        }
        
        .worm-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        
        .worm-body {
            position: absolute;
            width: 25px;
            height: 6px;
            background: linear-gradient(90deg, #8B4513 0%, #A0522D 30%, #8B4513 60%, #654321 100%);
            border-radius: 3px;
            animation: wormCrawl 3s ease-in-out;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        
        .worm-body::before {
            content: '';
            position: absolute;
            width: 4px;
            height: 4px;
            background: #654321;
            border-radius: 50%;
            left: -2px;
            top: 1px;
            box-shadow: 2px 0 0 #654321, 4px 0 0 #654321;
        }
        
        @keyframes wormCrawl {
            0% { 
                transform: translateX(-60px) translateY(60px) rotate(-10deg); 
                opacity: 0; 
            }
            20% { 
                opacity: 1; 
                transform: translateX(-30px) translateY(40px) rotate(5deg); 
            }
            40% { 
                transform: translateX(0px) translateY(20px) rotate(-5deg); 
            }
            60% { 
                transform: translateX(20px) translateY(10px) rotate(10deg); 
            }
            80% { 
                transform: translateX(40px) translateY(-10px) rotate(-5deg); 
            }
            100% { 
                transform: translateX(70px) translateY(-30px) rotate(15deg); 
                opacity: 0; 
            }
        }
        
        .sick-effect {
            animation: sickShake 0.5s ease-in-out 3;
            filter: sepia(1) hue-rotate(60deg) saturate(0.8);
        }
        
        @keyframes sickShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .storm-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            background: linear-gradient(45deg, rgba(75, 85, 99, 0.3) 0%, rgba(107, 114, 128, 0.4) 50%, rgba(75, 85, 99, 0.3) 100%);
            animation: stormShake 2s ease-out;
        }
        
        .lightning {
            position: absolute;
            width: 3px;
            height: 60px;
            background: linear-gradient(180deg, #FFFF00 0%, #FFD700 50%, #FFA500 100%);
            border-radius: 1px;
            animation: lightning 0.3s ease-out;
            box-shadow: 0 0 10px #FFFF00, 0 0 20px #FFD700;
        }
        
        @keyframes stormShake {
            0%, 100% { transform: rotate(0deg) scale(1); opacity: 0; }
            10% { transform: rotate(-2deg) scale(1.05); opacity: 0.8; }
            20% { transform: rotate(2deg) scale(1.1); opacity: 0.9; }
            30% { transform: rotate(-1deg) scale(1.05); opacity: 0.7; }
            40% { transform: rotate(1deg) scale(1.08); opacity: 0.8; }
            50% { transform: rotate(-2deg) scale(1.1); opacity: 0.9; }
            60% { transform: rotate(2deg) scale(1.05); opacity: 0.7; }
            70% { transform: rotate(-1deg) scale(1.08); opacity: 0.8; }
            80% { transform: rotate(1deg) scale(1.05); opacity: 0.6; }
            90% { transform: rotate(-1deg) scale(1.02); opacity: 0.4; }
        }
        
        @keyframes lightning {
            0% { opacity: 0; transform: scaleY(0); }
            50% { opacity: 1; transform: scaleY(1); }
            100% { opacity: 0; transform: scaleY(0.8); }
        }
        
        .btn-3d {
            background: linear-gradient(145deg, var(--primary), #45a049);
            box-shadow: 0 8px 15px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        
        .btn-3d:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(76, 175, 80, 0.4);
        }
        
        .btn-3d:active {
            transform: translateY(1px);
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }
        
        .progress-3d {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            animation: progressPulse 2s infinite alternate;
        }
        
        @keyframes progressPulse {
            0% { box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1), 0 0 10px rgba(76, 175, 80, 0.3); }
            100% { box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1), 0 0 20px rgba(76, 175, 80, 0.6); }
        }
        
        .wheel-container {
            perspective: 1000px;
        }
        
        .wheel-3d {
            transform-style: preserve-3d;
            transition: transform 3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.3));
        }
        
        .wheel-glow {
            animation: wheelGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes wheelGlow {
            0% { 
                filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.3)) drop-shadow(0 0 20px rgba(255, 215, 0, 0.3)); 
            }
            100% { 
                filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.3)) drop-shadow(0 0 40px rgba(255, 215, 0, 0.6)); 
            }
        }
        
        .wheel-spinning {
            animation: wheelSpin 0.1s linear infinite;
        }
        
        @keyframes wheelSpin {
            0% { filter: brightness(1) saturate(1); }
            50% { filter: brightness(1.2) saturate(1.3); }
            100% { filter: brightness(1) saturate(1); }
        }
        
        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }
            70% {
                transform: scale(0.9);
                opacity: 0.9;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .student-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            backdrop-filter: blur(10px);
            border: 2px solid rgba(76, 175, 80, 0.2);
            transition: all 0.3s ease;
        }
        
        .student-card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: var(--primary);
            box-shadow: 0 15px 30px rgba(76, 175, 80, 0.2);
        }
        
        .tree-selection {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .tree-selection:hover {
            transform: scale(1.1) rotateY(10deg);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .tree-selection.selected {
            border-color: var(--highlight);
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .action-btn {
            background: linear-gradient(145deg, var(--secondary), #FF8F00);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 183, 77, 0.4);
        }
        
        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .action-btn:hover::before {
            left: 100%;
        }
        
        /* Accessibility Styles */
        .reduced-motion * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
        
        .high-contrast {
            filter: contrast(150%) brightness(110%);
        }
        
        .high-contrast .glass-card {
            background: rgba(255, 255, 255, 1);
            border: 2px solid #000;
        }
        
        .high-contrast .btn-3d {
            background: #000 !important;
            color: #fff !important;
            border: 2px solid #fff;
        }
        
        body.font-large {
            font-size: 1.2em;
        }
        
        body.font-extra-large {
            font-size: 1.5em;
        }
        
        @keyframes fireworkExplode {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(calc(-50% + var(--end-x)), calc(-50% + var(--end-y))) scale(0);
                opacity: 0;
            }
        }
        
        @keyframes sparkle {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1.2) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                transform: scale(0) rotate(360deg);
                opacity: 0;
            }
        }
        
        @keyframes notificationRipple {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(4);
                opacity: 0;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="gradient-bg">
    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-6">
        <div class="glass-card rounded-3xl p-8 w-full max-w-md floating">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">üå≥</div>
                <h1 class="game-title text-4xl text-green-600 mb-2">Interactive Tree Garden</h1>
                <p class="text-gray-600 text-lg">‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡∏°</p>
                <div class="mt-4 text-sm text-gray-500">
                    ‡∏õ‡∏•‡∏π‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô
                </div>
            </div>
            
            <div class="space-y-4">
                <button onclick="showLogin('teacher')" class="w-full btn-3d text-white py-4 rounded-2xl font-bold text-lg flex items-center justify-center space-x-3">
                    <span class="text-2xl">üë©‚Äçüè´</span>
                    <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏π</span>
                </button>
                <button onclick="showLogin('student')" class="w-full btn-3d text-white py-4 rounded-2xl font-bold text-lg flex items-center justify-center space-x-3">
                    <span class="text-2xl">üéì</span>
                    <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏π -->
    <div id="teacherLogin" class="hidden min-h-screen flex items-center justify-center p-6">
        <div class="glass-card rounded-3xl p-8 w-full max-w-md">
            <div class="text-center mb-6">
                <div class="text-5xl mb-4">üë©‚Äçüè´</div>
                <h2 class="game-title text-3xl text-purple-600">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏π</h2>
            </div>
            <div class="space-y-4">
                <input type="text" id="teacherUsername" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-lg">
                <input type="password" id="teacherPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-lg">
                <button onclick="teacherLogin()" class="w-full btn-3d text-white py-4 rounded-2xl font-bold text-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                <div class="text-center space-y-2">
                    <button onclick="showTeacherRegister()" class="text-blue-600 hover:text-blue-800 font-bold underline block">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà</button>
                    <button onclick="showForgotPassword()" class="text-orange-600 hover:text-orange-800 font-bold underline block">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</button>
                </div>
                <button onclick="backToMain()" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-2xl font-bold">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>
    </div>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ñ‡∏£‡∏π -->
    <div id="teacherRegister" class="hidden min-h-screen flex items-center justify-center p-6">
        <div class="glass-card rounded-3xl p-8 w-full max-w-md">
            <div class="text-center mb-6">
                <div class="text-5xl mb-4">üìù</div>
                <h2 class="game-title text-3xl text-green-600">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏£‡∏π</h2>
                <p class="text-gray-600 mt-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
            </div>
            <div class="space-y-4">
                <input type="text" id="registerFullName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-lg">
                <input type="email" id="registerEmail" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-lg">
                <input type="text" id="registerUsername" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-lg">
                <input type="password" id="registerPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß)" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-lg">
                <input type="password" id="registerConfirmPassword" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-lg">
                <input type="text" id="registerSchool" placeholder="‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-lg">
                <button onclick="teacherRegister()" class="w-full btn-3d text-white py-4 rounded-2xl font-bold text-lg">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
                <div class="text-center">
                    <button onclick="showTeacherLogin()" class="text-blue-600 hover:text-blue-800 font-bold underline">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
                <button onclick="backToMain()" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-2xl font-bold">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>
    </div>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô -->
    <div id="forgotPassword" class="hidden min-h-screen flex items-center justify-center p-6">
        <div class="glass-card rounded-3xl p-8 w-full max-w-md">
            <div class="text-center mb-6">
                <div class="text-5xl mb-4">üîë</div>
                <h2 class="game-title text-3xl text-orange-600">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h2>
                <p class="text-gray-600 mt-2">‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</p>
            </div>
            <div class="space-y-4">
                <input type="text" id="forgotUsername" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-lg">
                <button onclick="resetPassword()" class="w-full btn-3d text-white py-4 rounded-2xl font-bold text-lg">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
                <div class="text-center">
                    <button onclick="showTeacherLogin()" class="text-blue-600 hover:text-blue-800 font-bold underline">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
                <button onclick="backToMain()" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-2xl font-bold">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>
    </div>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
    <div id="studentLogin" class="hidden min-h-screen flex items-center justify-center p-6">
        <div class="glass-card rounded-3xl p-8 w-full max-w-md">
            <div class="text-center mb-6">
                <div class="text-5xl mb-4">üéì</div>
                <h2 class="game-title text-3xl text-green-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
            </div>
            <div class="space-y-4">
                <input type="text" id="studentCode" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-center text-2xl font-bold tracking-wider">
                <button onclick="studentLogin()" class="w-full btn-3d text-white py-4 rounded-2xl font-bold text-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏™‡∏ß‡∏ô</button>
                <button onclick="backToMain()" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-2xl font-bold">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>
    </div>

    <!-- ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ñ‡∏£‡∏π -->
    <div id="teacherDashboard" class="hidden min-h-screen">
        <!-- Header -->
        <div class="glass-card mx-6 mt-6 rounded-2xl p-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="text-4xl">üå≥</div>
                    <div>
                        <h1 class="game-title text-2xl text-green-600">Teacher Dashboard</h1>
                        <p class="text-gray-600" id="teacherWelcomeText">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <div class="font-bold text-gray-800" id="teacherNameDisplay"></div>
                        <div class="text-sm text-gray-600" id="teacherSchoolDisplay"></div>
                    </div>
                    <button onclick="showTeacherProfile()" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-xl">
                        <span class="text-xl">üë§</span>
                    </button>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl font-bold transition-all">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
            </div>
        </div>

        <div class="flex h-screen pt-6">
            <!-- Sidebar -->
            <div class="w-80 px-6">
                <div class="glass-card rounded-2xl p-6 h-full">
                    <h3 class="text-xl font-bold text-purple-600 mb-4 flex items-center">
                        <span class="text-2xl mr-2">üìö</span>
                        ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                    </h3>
                    
                    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
                    <div class="mb-6">
                        <input type="text" id="classroomName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="w-full p-3 rounded-xl border-2 border-gray-200 mb-3 focus:border-green-500 outline-none">
                        <button onclick="createClassroom()" class="w-full btn-3d text-white py-3 rounded-xl font-bold">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                    </div>

                    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
                    <div id="classroomsList" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                    </div>

                    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h4 class="font-bold text-blue-600 mb-3 flex items-center">
                            <span class="text-xl mr-2">üë•</span>
                            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                        </h4>
                        <select id="classroomSelect" class="w-full p-3 rounded-xl border-2 border-gray-200 mb-3 focus:border-green-500 outline-none">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                        </select>
                        <textarea id="studentNames" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÅ‡∏¢‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)" class="w-full p-3 rounded-xl border-2 border-gray-200 mb-3 h-24 focus:border-green-500 outline-none resize-none"></textarea>
                        <button onclick="addStudents()" class="w-full btn-3d text-white py-3 rounded-xl font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                    </div>

                    <!-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à -->
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h4 class="font-bold text-orange-600 mb-3 flex items-center">
                            <span class="text-xl mr-2">üéØ</span>
                            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                        </h4>
                        <input type="text" id="missionTitle" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à" class="w-full p-3 rounded-xl border-2 border-gray-200 mb-3 focus:border-green-500 outline-none">
                        <textarea id="missionDescription" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à" class="w-full p-3 rounded-xl border-2 border-gray-200 mb-3 h-20 focus:border-green-500 outline-none resize-none"></textarea>
                        <input type="number" id="missionReward" placeholder="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•" min="1" max="100" class="w-full p-3 rounded-xl border-2 border-gray-200 mb-3 focus:border-green-500 outline-none">
                        <button onclick="createMission()" class="w-full btn-3d text-white py-3 rounded-xl font-bold">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</button>
                    </div>

                    <!-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® -->
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h4 class="font-bold text-purple-600 mb-3 flex items-center">
                            <span class="text-xl mr-2">üì¢</span>
                            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
                        </h4>
                        <input type="text" id="announcementTitle" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®" class="w-full p-3 rounded-xl border-2 border-gray-200 mb-3 focus:border-green-500 outline-none">
                        <textarea id="announcementMessage" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®" class="w-full p-3 rounded-xl border-2 border-gray-200 mb-3 h-20 focus:border-green-500 outline-none resize-none"></textarea>
                        <button onclick="createAnnouncement()" class="w-full btn-3d text-white py-3 rounded-xl font-bold">‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</button>
                    </div>

                    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà -->
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h4 class="font-bold text-green-600 mb-3 flex items-center">
                            <span class="text-xl mr-2">üìã</span>
                            ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà
                        </h4>
                        <div id="teacherMissionsList" class="space-y-2 max-h-48 overflow-y-auto">
                            <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="flex-1 px-6">
                <div class="glass-card rounded-2xl p-6 h-full">
                    <!-- Students Grid -->
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üå±</span>
                            ‡∏™‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                            <span id="selectedClassroomName" class="ml-2 text-green-600"></span>
                        </h3>
                        <div id="studentsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 max-h-96 overflow-y-auto">
                            <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                        </div>
                    </div>

                    <!-- Class Position Board -->
                    <div class="border-t border-gray-200 pt-6 mb-6">
                        <h4 class="font-bold text-purple-600 mb-4 flex items-center">
                            <span class="text-xl mr-2">üèÜ</span>
                            ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á
                        </h4>
                        <div id="classPositionBoard" class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-4 max-h-48 overflow-y-auto">
                            <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                        </div>
                    </div>

                    <!-- Action Bar -->
                    <div class="border-t border-gray-200 pt-6">
                        <h4 class="font-bold text-orange-600 mb-4 flex items-center">
                            <span class="text-xl mr-2">‚ö°</span>
                            ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥
                        </h4>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                            <button onclick="showActionModal('water')" class="action-btn text-white py-3 px-4 rounded-xl font-bold text-sm flex flex-col items-center">
                                <span class="text-2xl mb-1">üíß</span>
                                <span>‡∏£‡∏î‡∏ô‡πâ‡∏≥ +10</span>
                            </button>
                            <button onclick="showActionModal('fertilizer')" class="action-btn text-white py-3 px-4 rounded-xl font-bold text-sm flex flex-col items-center">
                                <span class="text-2xl mb-1">üå±</span>
                                <span>‡∏õ‡∏∏‡πã‡∏¢ +20</span>
                            </button>
                            <button onclick="showActionModal('rain')" class="action-btn text-white py-3 px-4 rounded-xl font-bold text-sm flex flex-col items-center">
                                <span class="text-2xl mb-1">üåßÔ∏è</span>
                                <span>‡∏ù‡∏ô +30</span>
                            </button>
                            <button onclick="showActionModal('worm')" class="action-btn bg-red-500 hover:bg-red-600 text-white py-3 px-4 rounded-xl font-bold text-sm flex flex-col items-center">
                                <span class="text-2xl mb-1">üêõ</span>
                                <span>‡∏´‡∏ô‡∏≠‡∏ô -10</span>
                            </button>
                            <button onclick="showActionModal('sick')" class="action-btn bg-red-500 hover:bg-red-600 text-white py-3 px-4 rounded-xl font-bold text-sm flex flex-col items-center">
                                <span class="text-2xl mb-1">ü§í</span>
                                <span>‡∏õ‡πà‡∏ß‡∏¢ -20</span>
                            </button>
                            <button onclick="showActionModal('storm')" class="action-btn bg-red-500 hover:bg-red-600 text-white py-3 px-4 rounded-xl font-bold text-sm flex flex-col items-center">
                                <span class="text-2xl mb-1">‚õàÔ∏è</span>
                                <span>‡∏û‡∏≤‡∏¢‡∏∏ -30</span>
                            </button>
                        </div>
                        
                        <!-- Wheel of Names -->
                        <div class="mt-4 flex space-x-4">
                            <button onclick="showWheelModal()" class="btn-3d text-white py-3 px-6 rounded-xl font-bold flex items-center space-x-2">
                                <span class="text-2xl">üéØ</span>
                                <span>‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠</span>
                            </button>
                            <button onclick="showTreeImageModal()" class="bg-purple-500 hover:bg-purple-600 text-white py-3 px-6 rounded-xl font-bold flex items-center space-x-2">
                                <span class="text-2xl">üé®</span>
                                <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
    <div id="studentDashboard" class="hidden min-h-screen p-6">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="glass-card rounded-2xl p-6 mb-6">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <div class="text-5xl">üå±</div>
                        <div>
                            <h1 class="game-title text-3xl text-green-600" id="studentWelcome">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö!</h1>
                            <p class="text-gray-600 text-lg" id="studentProgress">‡∏£‡∏∞‡∏î‡∏±‡∏ö 1 - ‡πÄ‡∏°‡∏•‡πá‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</p>
                            <p class="text-purple-600 font-bold" id="studentPosition">üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà - ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="showMissions()" class="relative bg-orange-500 hover:bg-orange-600 text-white p-3 rounded-xl">
                            <span class="text-xl">üéØ</span>
                            <span id="missionBadge" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center">0</span>
                        </button>
                        <button onclick="showNotifications()" class="relative bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-xl">
                            <span class="text-xl">üì¨</span>
                            <span id="notificationBadge" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center">0</span>
                        </button>
                        <button onclick="showSettings()" class="bg-gray-500 hover:bg-gray-600 text-white p-3 rounded-xl">
                            <span class="text-xl">‚öôÔ∏è</span>
                        </button>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl font-bold">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                    </div>
                </div>
            </div>

            <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ -->
            <div id="treeSelection" class="hidden glass-card rounded-2xl p-8 mb-6">
                <h2 class="text-2xl font-bold text-center mb-6 flex items-center justify-center">
                    <span class="text-3xl mr-3">üå±</span>
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                    <div onclick="selectTree('apple')" class="tree-selection glass-card p-6 rounded-xl text-center cursor-pointer border-2 border-transparent">
                        <div class="text-5xl mb-3 tree-3d">üçé</div>
                        <div class="font-bold text-red-600">‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•</div>
                    </div>
                    <div onclick="selectTree('orange')" class="tree-selection glass-card p-6 rounded-xl text-center cursor-pointer border-2 border-transparent">
                        <div class="text-5xl mb-3 tree-3d">üçä</div>
                        <div class="font-bold text-orange-600">‡∏ï‡πâ‡∏ô‡∏™‡πâ‡∏°</div>
                    </div>
                    <div onclick="selectTree('candy')" class="tree-selection glass-card p-6 rounded-xl text-center cursor-pointer border-2 border-transparent">
                        <div class="text-5xl mb-3 tree-3d">üç≠</div>
                        <div class="font-bold text-pink-600">‡∏ï‡πâ‡∏ô‡∏•‡∏π‡∏Å‡∏≠‡∏°</div>
                    </div>
                    <div onclick="selectTree('donut')" class="tree-selection glass-card p-6 rounded-xl text-center cursor-pointer border-2 border-transparent">
                        <div class="text-5xl mb-3 tree-3d">üç©</div>
                        <div class="font-bold text-yellow-600">‡∏ï‡πâ‡∏ô‡πÇ‡∏î‡∏ô‡∏±‡∏ó</div>
                    </div>
                    <div onclick="selectTree('sweet')" class="tree-selection glass-card p-6 rounded-xl text-center cursor-pointer border-2 border-transparent">
                        <div class="text-5xl mb-3 tree-3d">üßÅ</div>
                        <div class="font-bold text-purple-600">‡∏ï‡πâ‡∏ô‡∏Ç‡∏ô‡∏°</div>
                    </div>
                    <div onclick="selectTree('data')" class="tree-selection glass-card p-6 rounded-xl text-center cursor-pointer border-2 border-transparent">
                        <div class="text-5xl mb-3 tree-3d">üíæ</div>
                        <div class="font-bold text-blue-600">‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                    </div>
                </div>
            </div>

            <!-- ‡∏™‡∏ß‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ -->
            <div class="glass-card rounded-2xl p-8 text-center">
                <!-- Progress Bar -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <span id="currentPoints" class="font-bold text-gray-700">0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
                        <span id="nextLevel" class="font-bold text-green-600">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: 20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
                    </div>
                    <div class="bg-gray-200 rounded-full h-6 relative overflow-hidden">
                        <div id="progressBar" class="progress-3d h-6 rounded-full transition-all duration-1000" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Tree Display -->
                <div class="relative inline-block mb-8">
                    <div id="treeDisplay" class="tree-3d text-9xl mb-4 relative">
                        üå±
                    </div>
                    <div id="effectOverlay" class="absolute inset-0 pointer-events-none"></div>
                </div>

                <div id="treeInfo" class="text-xl font-bold text-gray-800 mb-4">
                    ‡πÄ‡∏°‡∏•‡πá‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå - ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï!
                </div>

                <!-- Level Badge -->
                <div id="levelBadge" class="inline-block bg-gradient-to-r from-green-400 to-green-600 text-white px-6 py-2 rounded-full font-bold text-lg pulse-glow">
                    ‡∏£‡∏∞‡∏î‡∏±‡∏ö 1
                </div>
            </div>

            <!-- ‡∏™‡∏ß‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß -->
            <div id="gardenSection" class="hidden glass-card rounded-2xl p-8 mt-6">
                <h3 class="text-2xl font-bold text-center mb-6 flex items-center justify-center">
                    <span class="text-3xl mr-3">üè°</span>
                    ‡∏™‡∏ß‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                    <span id="gardenCount" class="ml-2 bg-purple-500 text-white px-3 py-1 rounded-full text-sm">0 ‡∏ï‡πâ‡∏ô</span>
                </h3>
                <div id="gardenGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4">
                    <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥ -->
    <div id="actionModal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50">
        <div class="glass-card rounded-2xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-4 text-center" id="actionTitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
            <div class="mb-6">
                <select id="actionStudentSelect" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-lg">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                    <option value="all">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                </select>
            </div>
            <div class="flex space-x-4">
                <button onclick="applyAction()" class="flex-1 btn-3d text-white py-3 rounded-xl font-bold">‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥</button>
                <button onclick="closeActionModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-xl font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠ -->
    <div id="wheelModal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
        <div class="glass-card rounded-2xl p-4 sm:p-8 w-full max-w-4xl max-h-screen overflow-y-auto">
            <h3 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-center">üéØ ‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠</h3>
            
            <div class="wheel-container mb-4 sm:mb-6 flex justify-center">
                <div class="relative" id="wheelContainer">
                    <!-- Wheel Pointer -->
                    <div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-3 z-20">
                        <div class="relative">
                            <!-- Main pointer -->
                            <div class="w-0 h-0 border-l-6 border-r-6 border-b-16 sm:border-l-8 sm:border-r-8 sm:border-b-20 border-l-transparent border-r-transparent border-b-red-600 drop-shadow-2xl"></div>
                            <!-- Pointer highlight -->
                            <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-3 border-r-3 border-b-8 sm:border-l-4 sm:border-r-4 sm:border-b-10 border-l-transparent border-r-transparent border-b-red-400"></div>
                            <!-- Pointer base -->
                            <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 w-4 h-4 sm:w-6 sm:h-6 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full border-2 border-white shadow-lg"></div>
                        </div>
                    </div>
                    
                    <!-- Wheel -->
                    <div id="wheelCanvas" class="wheel-3d rounded-full border-4 sm:border-8 border-yellow-400 relative overflow-hidden shadow-2xl" style="background: #f0f0f0;">
                        <canvas id="wheelSegments" class="absolute inset-0 rounded-full"></canvas>
                        
                        <!-- Center Circle -->
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-8 h-8 sm:w-12 md:w-16 sm:h-12 md:h-16 bg-yellow-400 rounded-full border-2 sm:border-4 border-white shadow-lg flex items-center justify-center">
                                <div class="text-lg sm:text-xl md:text-2xl">üéØ</div>
                            </div>
                        </div>
                        
                        <!-- Names Display -->
                        <div id="wheelNames" class="absolute inset-0 pointer-events-none">
                            <!-- Names will be positioned here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mb-6">
                <button onclick="spinWheel()" id="spinButton" class="btn-3d text-white px-8 py-4 rounded-xl font-bold text-lg">
                    üé≤ ‡∏´‡∏°‡∏∏‡∏ô‡∏ß‡∏á‡∏•‡πâ‡∏≠
                </button>
            </div>
            
            <div id="wheelResult" class="hidden text-center mb-4">
                <div class="text-2xl font-bold text-green-600 mb-2">üéâ ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞!</div>
                <div id="winnerName" class="text-xl font-bold"></div>
            </div>
            
            <div class="text-center">
                <button onclick="closeWheelModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-bold">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à -->
    <div id="missionModal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50">
        <div class="glass-card rounded-2xl p-8 max-w-md w-full mx-4 max-h-96 overflow-y-auto">
            <h3 class="text-2xl font-bold mb-6 text-center flex items-center justify-center">
                <span class="text-3xl mr-2">üéØ</span>
                ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
            </h3>
            <div id="missionsList" class="space-y-3 mb-6">
                <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
            </div>
            <div class="text-center">
                <button onclick="closeMissionModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-bold">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
    <div id="notificationModal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50">
        <div class="glass-card rounded-2xl p-8 max-w-md w-full mx-4 max-h-96 overflow-y-auto">
            <h3 class="text-2xl font-bold mb-6 text-center flex items-center justify-center">
                <span class="text-3xl mr-2">üì¨</span>
                ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            </h3>
            <div id="notificationsList" class="space-y-3 mb-6">
                <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
            </div>
            <div class="text-center">
                <button onclick="closeNotificationModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-bold">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ -->
    <div id="settingsModal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50">
        <div class="glass-card rounded-2xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-6 text-center flex items-center justify-center">
                <span class="text-3xl mr-2">‚öôÔ∏è</span>
                ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            </h3>
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <span class="font-bold">‡πÄ‡∏™‡∏µ‡∏¢‡∏á</span>
                    <button onclick="toggleSound()" id="soundToggle" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-xl font-bold">‡πÄ‡∏õ‡∏¥‡∏î</button>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-bold">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á</span>
                    <input type="range" id="volumeSlider" min="0" max="100" value="50" class="w-24">
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-bold">‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß</span>
                    <button onclick="toggleMotion()" id="motionToggle" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-xl font-bold">‡∏õ‡∏¥‡∏î</button>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-bold">‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</span>
                    <select id="fontSizeSelect" class="p-2 rounded-xl border-2 border-gray-200">
                        <option value="normal">‡∏õ‡∏Å‡∏ï‡∏¥</option>
                        <option value="large">‡πÉ‡∏´‡∏ç‡πà</option>
                        <option value="extra-large">‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å</option>
                    </select>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-bold">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°‡∏ä‡∏±‡∏î‡∏™‡∏µ</span>
                    <button onclick="toggleContrast()" id="contrastToggle" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-xl font-bold">‡∏õ‡∏Å‡∏ï‡∏¥</button>
                </div>
            </div>
            <div class="text-center mt-6">
                <button onclick="closeSettingsModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-bold">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <!-- Modal View-as-Student -->
    <div id="viewAsStudentModal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50">
        <div class="glass-card rounded-2xl p-8 max-w-4xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold flex items-center">
                    <span class="text-3xl mr-2">üëÅÔ∏è</span>
                    ‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
                </h3>
                <button onclick="closeViewAsStudentModal()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-xl font-bold">‡∏õ‡∏¥‡∏î</button>
            </div>
            <div id="studentViewContent" class="text-center">
                <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à -->
    <div id="missionCompleteModal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50">
        <div class="glass-card rounded-2xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-4 text-center" id="missionCompleteTitle">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
            <div class="mb-6">
                <div id="missionCompleteInfo" class="text-center text-gray-700 mb-4"></div>
                <select id="missionCompleteStudentSelect" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-lg">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                    <option value="all">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                </select>
            </div>
            <div class="flex space-x-4">
                <button onclick="completeMission()" class="flex-1 btn-3d text-white py-3 rounded-xl font-bold">‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</button>
                <button onclick="closeMissionCompleteModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-xl font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <!-- Modal ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ -->
    <div id="treeImageModal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50">
        <div class="glass-card rounded-2xl p-8 max-w-4xl w-full mx-4 max-h-96 overflow-y-auto">
            <h3 class="text-2xl font-bold mb-6 text-center flex items-center justify-center">
                <span class="text-3xl mr-2">üé®</span>
                ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            </h3>
            
            <div class="mb-6">
                <label class="block text-sm font-bold text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                <select id="treeImageStudentSelect" class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none text-lg">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                    <option value="all">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                </select>
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-bold text-gray-700 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà</label>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                    <div onclick="selectNewTreeType('apple')" class="new-tree-selection glass-card p-4 rounded-xl text-center cursor-pointer border-2 border-transparent hover:border-red-400 transition-all">
                        <div class="text-4xl mb-2">üçé</div>
                        <div class="font-bold text-red-600 text-sm">‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•</div>
                    </div>
                    <div onclick="selectNewTreeType('orange')" class="new-tree-selection glass-card p-4 rounded-xl text-center cursor-pointer border-2 border-transparent hover:border-orange-400 transition-all">
                        <div class="text-4xl mb-2">üçä</div>
                        <div class="font-bold text-orange-600 text-sm">‡∏ï‡πâ‡∏ô‡∏™‡πâ‡∏°</div>
                    </div>
                    <div onclick="selectNewTreeType('candy')" class="new-tree-selection glass-card p-4 rounded-xl text-center cursor-pointer border-2 border-transparent hover:border-pink-400 transition-all">
                        <div class="text-4xl mb-2">üç≠</div>
                        <div class="font-bold text-pink-600 text-sm">‡∏ï‡πâ‡∏ô‡∏•‡∏π‡∏Å‡∏≠‡∏°</div>
                    </div>
                    <div onclick="selectNewTreeType('donut')" class="new-tree-selection glass-card p-4 rounded-xl text-center cursor-pointer border-2 border-transparent hover:border-yellow-400 transition-all">
                        <div class="text-4xl mb-2">üç©</div>
                        <div class="font-bold text-yellow-600 text-sm">‡∏ï‡πâ‡∏ô‡πÇ‡∏î‡∏ô‡∏±‡∏ó</div>
                    </div>
                    <div onclick="selectNewTreeType('sweet')" class="new-tree-selection glass-card p-4 rounded-xl text-center cursor-pointer border-2 border-transparent hover:border-purple-400 transition-all">
                        <div class="text-4xl mb-2">üßÅ</div>
                        <div class="font-bold text-purple-600 text-sm">‡∏ï‡πâ‡∏ô‡∏Ç‡∏ô‡∏°</div>
                    </div>
                    <div onclick="selectNewTreeType('data')" class="new-tree-selection glass-card p-4 rounded-xl text-center cursor-pointer border-2 border-transparent hover:border-blue-400 transition-all">
                        <div class="text-4xl mb-2">üíæ</div>
                        <div class="font-bold text-blue-600 text-sm">‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                    </div>
                    <div onclick="selectNewTreeType('custom')" class="new-tree-selection glass-card p-4 rounded-xl text-center cursor-pointer border-2 border-transparent hover:border-green-400 transition-all">
                        <div class="text-4xl mb-2">üìÅ</div>
                        <div class="font-bold text-green-600 text-sm">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà</div>
                    </div>
                </div>
                
                <!-- Custom Image Upload Section -->
                <div id="customImageSection" class="hidden mb-6 p-4 bg-green-50 rounded-xl border-2 border-green-200">
                    <h5 class="font-bold text-green-700 mb-3">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà</h5>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ</label>
                            <input type="text" id="customTreeName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡πâ‡∏ô‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á, ‡∏ï‡πâ‡∏ô‡∏Å‡∏∏‡∏´‡∏•‡∏≤ÿ®" class="w-full p-3 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                            <input type="file" id="customTreeImage" accept="image/*" class="w-full p-3 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none bg-white">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                            <input type="url" id="customTreeUrl" placeholder="https://example.com/tree-image.jpg" class="w-full p-3 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none">
                        </div>
                        <div id="customTreePreview" class="hidden text-center p-4 bg-white rounded-xl border-2 border-gray-200">
                            <div class="text-sm text-gray-600 mb-2">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</div>
                            <img id="previewImage" class="w-16 h-16 object-cover rounded-lg mx-auto" alt="Preview">
                            <div id="previewName" class="text-sm font-bold text-gray-700 mt-2"></div>
                        </div>
                        <button onclick="previewCustomTree()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-xl font-bold">‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-4">
                <button onclick="applyTreeImageChange()" class="flex-1 btn-3d text-white py-3 rounded-xl font-bold">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ</button>
                <button onclick="closeTreeImageModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-xl font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <!-- Modal ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏£‡∏π -->
    <div id="teacherProfileModal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50">
        <div class="glass-card rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold flex items-center">
                    <span class="text-3xl mr-2">üë§</span>
                    ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏£‡∏π
                </h3>
                <button onclick="closeTeacherProfileModal()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-xl font-bold">‡∏õ‡∏¥‡∏î</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="profileFullName" class="w-full p-3 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                    <input type="email" id="profileEmail" class="w-full p-3 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="profileUsername" class="w-full p-3 rounded-xl border-2 border-gray-200 bg-gray-100" readonly>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô</label>
                    <input type="text" id="profileSchool" class="w-full p-3 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</label>
                    <input type="password" id="profileNewPassword" class="w-full p-3 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                    <input type="password" id="profileConfirmPassword" class="w-full p-3 rounded-xl border-2 border-gray-200 focus:border-green-500 outline-none">
                </div>
            </div>
            <div class="flex space-x-4 mt-6">
                <button onclick="updateTeacherProfile()" class="flex-1 btn-3d text-white py-3 rounded-xl font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</button>
                <button onclick="closeTeacherProfileModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-xl font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <!-- Floating Notifications -->
    <div id="floatingNotifications" class="fixed top-4 right-4 space-y-2 z-40"></div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°
        let gameData = {
            teachers: [], // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π
            classrooms: [],
            students: [],
            missions: [], // ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
            announcements: [], // ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
            currentUser: null,
            currentStudent: null,
            selectedClassroom: null,
            selectedMission: null,
            wheelHistory: {}, // ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á
            settings: {
                soundEnabled: true,
                volume: 50,
                reducedMotion: false,
                fontSize: 'normal',
                highContrast: false
            }
        };

        // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ
        const treeStages = [
            { name: '‡πÄ‡∏°‡∏•‡πá‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå', points: 0, emoji: 'üå±', description: '‡πÄ‡∏°‡∏•‡πá‡∏î‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û', level: 1 },
            { name: '‡∏´‡∏ô‡πà‡∏≠‡∏≠‡∏≠‡πà‡∏≠‡∏ô', points: 20, emoji: 'üåø', description: '‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï!', level: 2 },
            { name: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÄ‡∏•‡πá‡∏Å', points: 50, emoji: 'üå≥', description: '‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô', level: 3 },
            { name: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏ï', points: 100, emoji: 'üå≤', description: '‡πÄ‡∏≠‡∏∑‡πâ‡∏≠‡∏°‡∏°‡∏∑‡∏≠‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤', level: 4 },
            { name: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ï‡∏±‡∏ß', points: 150, emoji: 'üå¥', description: '‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏î‡∏µ', level: 5 },
            { name: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ 2 ‡∏î‡∏≠‡∏Å', points: 200, emoji: 'üå∏üå≥', description: '‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏¥', level: 6 },
            { name: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ 5 ‡∏î‡∏≠‡∏Å', points: 250, emoji: 'üå∏üå∏üå≥üå∏üå∏', description: '‡∏ö‡∏≤‡∏ô‡∏™‡∏∞‡∏û‡∏£‡∏±‡πà‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡∏î‡∏á‡∏≤‡∏°', level: 7 },
            { name: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ 7 ‡∏î‡∏≠‡∏Å', points: 300, emoji: 'üå∏üå∏üå∏üå≥üå∏üå∏üå∏', description: '‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏≤', level: 8 },
            { name: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ 10 ‡∏î‡∏≠‡∏Å', points: 350, emoji: 'üå∏üå∏üå∏üå∏üå≥üå∏üå∏üå∏üå∏', description: '‡∏§‡∏î‡∏π‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏ö‡∏≤‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà', level: 9 },
            { name: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ 2 ‡∏ú‡∏• + ‡∏î‡∏≠‡∏Å', points: 400, emoji: 'üçéüå∏üå≥üå∏üçé', description: '‡∏ú‡∏•‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏Å', level: 10 },
            { name: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ 5 ‡∏ú‡∏•', points: 450, emoji: 'üçéüçéüå≥üçéüçé', description: '‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏î‡∏°‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', level: 11 },
            { name: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ 10 ‡∏ú‡∏•', points: 500, emoji: 'üçéüçéüçéüçéüå≥üçéüçéüçéüçé', description: '‡πÄ‡∏à‡πâ‡∏≤‡πÅ‡∏´‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ! ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß!', level: 12 }
        ];

        // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ
        const treeTypes = {
            apple: { fruit: 'üçé', color: 'text-red-500', name: '‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•' },
            orange: { fruit: 'üçä', color: 'text-orange-500', name: '‡∏™‡πâ‡∏°' },
            candy: { fruit: 'üç≠', color: 'text-pink-500', name: '‡∏•‡∏π‡∏Å‡∏≠‡∏°' },
            donut: { fruit: 'üç©', color: 'text-yellow-500', name: '‡πÇ‡∏î‡∏ô‡∏±‡∏ó' },
            sweet: { fruit: 'üßÅ', color: 'text-purple-500', name: '‡∏Ç‡∏ô‡∏°' },
            data: { fruit: 'üíæ', color: 'text-blue-500', name: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' }
        };

        // Custom tree types (‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡πÑ‡∏î‡∏ô‡∏≤‡∏°‡∏¥‡∏Å)
        let customTreeTypes = {};

        // ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥
        const actions = {
            water: { points: 10, effect: 'water', message: '‡∏Ñ‡∏£‡∏π‡∏£‡∏î‡∏ô‡πâ‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì! üíß (+10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)', title: '‡∏£‡∏î‡∏ô‡πâ‡∏≥' },
            fertilizer: { points: 20, effect: 'fertilizer', message: '‡∏Ñ‡∏£‡∏π‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢‡πÉ‡∏´‡πâ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì! üå± (+20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)', title: '‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢' },
            rain: { points: 30, effect: 'rain', message: '‡∏ù‡∏ô‡∏ï‡∏Å‡πÉ‡∏´‡πâ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì! üåßÔ∏è (+30 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)', title: '‡∏ù‡∏ô‡∏ï‡∏Å' },
            worm: { points: -10, effect: 'worm', message: '‡∏´‡∏ô‡∏≠‡∏ô‡∏°‡∏≤‡∏Å‡∏±‡∏î‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ! üêõ (-10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)', title: '‡∏´‡∏ô‡∏≠‡∏ô‡∏Å‡∏±‡∏î' },
            sick: { points: -20, effect: 'sick', message: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏õ‡πà‡∏ß‡∏¢! ü§í (-20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)', title: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏õ‡πà‡∏ß‡∏¢' },
            storm: { points: -30, effect: 'storm', message: '‡∏û‡∏≤‡∏¢‡∏∏‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ! ‚õàÔ∏è (-30 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)', title: '‡∏û‡∏≤‡∏¢‡∏∏' }
        };

        let currentAction = null;
        let selectedNewTreeType = null;

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage
        function loadData() {
            const saved = localStorage.getItem('tree-garden-data');
            if (saved) {
                gameData = JSON.parse(saved);
                // ‡πÇ‡∏´‡∏•‡∏î custom tree types
                if (gameData.customTreeTypes) {
                    customTreeTypes = gameData.customTreeTypes;
                }
            }
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á localStorage
        function saveData() {
            localStorage.setItem('tree-garden-data', JSON.stringify(gameData));
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        loadData();
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏£‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)
        if (gameData.teachers.length === 0) {
            const demoTeacher = {
                id: 1,
                fullName: '‡∏Ñ‡∏£‡∏π‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ',
                email: 'teacher@demo.com',
                username: 'teacher',
                password: '123456',
                school: '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á',
                createdAt: new Date().toISOString(),
                classrooms: []
            };
            gameData.teachers.push(demoTeacher);
            saveData();
        }

        function showLogin(type) {
            document.getElementById('loginScreen').classList.add('hidden');
            if (type === 'teacher') {
                document.getElementById('teacherLogin').classList.remove('hidden');
            } else {
                document.getElementById('studentLogin').classList.remove('hidden');
            }
        }

        function backToMain() {
            document.getElementById('teacherLogin').classList.add('hidden');
            document.getElementById('studentLogin').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        function teacherLogin() {
            const username = document.getElementById('teacherUsername').value.trim();
            const password = document.getElementById('teacherPassword').value;
            
            if (!username || !password) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô');
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π
            const teacher = gameData.teachers.find(t => t.username === username && t.password === password);
            
            if (teacher) {
                gameData.currentUser = { 
                    type: 'teacher', 
                    username: teacher.username,
                    fullName: teacher.fullName,
                    email: teacher.email,
                    school: teacher.school,
                    id: teacher.id
                };
                saveData();
                showTeacherDashboard();
                
                // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                document.getElementById('teacherUsername').value = '';
                document.getElementById('teacherPassword').value = '';
            } else {
                alert('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            }
        }

        function showTeacherRegister() {
            document.getElementById('teacherLogin').classList.add('hidden');
            document.getElementById('teacherRegister').classList.remove('hidden');
        }

        function showTeacherLogin() {
            document.getElementById('teacherRegister').classList.add('hidden');
            document.getElementById('forgotPassword').classList.add('hidden');
            document.getElementById('teacherLogin').classList.remove('hidden');
        }

        function showForgotPassword() {
            document.getElementById('teacherLogin').classList.add('hidden');
            document.getElementById('forgotPassword').classList.remove('hidden');
        }

        function teacherRegister() {
            const fullName = document.getElementById('registerFullName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const school = document.getElementById('registerSchool').value.trim();

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            if (!fullName || !email || !username || !password || !confirmPassword || !school) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á');
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
            const usernameRegex = /^[a-zA-Z0-9_]+$/;
            if (!usernameRegex.test(username)) {
                alert('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÅ‡∏•‡∏∞ _ ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
            if (password.length < 6) {
                alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
            if (password !== confirmPassword) {
                alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const existingTeacher = gameData.teachers.find(t => t.username === username || t.email === email);
            if (existingTeacher) {
                alert('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏£‡∏π‡πÉ‡∏´‡∏°‡πà
            const newTeacher = {
                id: Date.now(),
                fullName: fullName,
                email: email,
                username: username,
                password: password, // ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™
                school: school,
                createdAt: new Date().toISOString(),
                classrooms: []
            };

            gameData.teachers.push(newTeacher);
            saveData();

            alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
            document.getElementById('registerFullName').value = '';
            document.getElementById('registerEmail').value = '';
            document.getElementById('registerUsername').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('registerConfirmPassword').value = '';
            document.getElementById('registerSchool').value = '';
            
            showTeacherLogin();
        }

        function resetPassword() {
            const username = document.getElementById('forgotUsername').value.trim();
            
            if (!username) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
                return;
            }

            const teacher = gameData.teachers.find(t => t.username === username);
            
            if (teacher) {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°
                const newPassword = Math.random().toString(36).slice(-8);
                teacher.password = newPassword;
                saveData();

                alert(`‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà: ${newPassword}\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö\n\n(‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡∏™‡πà‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•)`);
                
                document.getElementById('forgotUsername').value = '';
                showTeacherLogin();
            } else {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
            }
        }

        function studentLogin() {
            const code = document.getElementById('studentCode').value.toUpperCase();
            
            if (code) {
                const student = gameData.students.find(s => s.code === code);
                if (student) {
                    gameData.currentStudent = student;
                    saveData();
                    showStudentDashboard();
                } else {
                    alert('‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡∏£‡∏π');
                }
            }
        }

        function logout() {
            gameData.currentUser = null;
            gameData.currentStudent = null;
            gameData.selectedClassroom = null;
            saveData();
            document.getElementById('teacherDashboard').classList.add('hidden');
            document.getElementById('studentDashboard').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        function showTeacherDashboard() {
            document.getElementById('teacherLogin').classList.add('hidden');
            document.getElementById('teacherDashboard').classList.remove('hidden');
            updateTeacherDashboard();
            updateTeacherHeader();
        }

        function updateTeacherHeader() {
            if (gameData.currentUser && gameData.currentUser.type === 'teacher') {
                document.getElementById('teacherNameDisplay').textContent = gameData.currentUser.fullName || gameData.currentUser.username;
                document.getElementById('teacherSchoolDisplay').textContent = gameData.currentUser.school || '';
                document.getElementById('teacherWelcomeText').textContent = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, ${gameData.currentUser.fullName || gameData.currentUser.username}!`;
            }
        }

        function showTeacherProfile() {
            if (!gameData.currentUser || gameData.currentUser.type !== 'teacher') return;
            
            const teacher = gameData.teachers.find(t => t.id === gameData.currentUser.id);
            if (!teacher) return;
            
            document.getElementById('profileFullName').value = teacher.fullName;
            document.getElementById('profileEmail').value = teacher.email;
            document.getElementById('profileUsername').value = teacher.username;
            document.getElementById('profileSchool').value = teacher.school;
            document.getElementById('profileNewPassword').value = '';
            document.getElementById('profileConfirmPassword').value = '';
            
            document.getElementById('teacherProfileModal').classList.remove('hidden');
        }

        function closeTeacherProfileModal() {
            document.getElementById('teacherProfileModal').classList.add('hidden');
        }

        function updateTeacherProfile() {
            if (!gameData.currentUser || gameData.currentUser.type !== 'teacher') return;
            
            const teacher = gameData.teachers.find(t => t.id === gameData.currentUser.id);
            if (!teacher) return;
            
            const fullName = document.getElementById('profileFullName').value.trim();
            const email = document.getElementById('profileEmail').value.trim();
            const school = document.getElementById('profileSchool').value.trim();
            const newPassword = document.getElementById('profileNewPassword').value;
            const confirmPassword = document.getElementById('profileConfirmPassword').value;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
            if (!fullName || !email || !school) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á');
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ã‡πâ‡∏≥ (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á)
            const existingTeacher = gameData.teachers.find(t => t.email === email && t.id !== teacher.id);
            if (existingTeacher) {
                alert('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            if (newPassword) {
                if (newPassword.length < 6) {
                    alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
                    return;
                }
                
                teacher.password = newPassword;
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            teacher.fullName = fullName;
            teacher.email = email;
            teacher.school = school;
            teacher.updatedAt = new Date().toISOString();
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            gameData.currentUser.fullName = fullName;
            gameData.currentUser.email = email;
            gameData.currentUser.school = school;
            
            saveData();
            updateTeacherHeader();
            closeTeacherProfileModal();
            
            alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        function showStudentDashboard() {
            document.getElementById('studentLogin').classList.add('hidden');
            document.getElementById('studentDashboard').classList.remove('hidden');
            updateStudentDashboard();
        }

        function createClassroom() {
            const name = document.getElementById('classroomName').value.trim();
            if (!name) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô');
                return;
            }
            
            if (!gameData.currentUser || gameData.currentUser.type !== 'teacher') {
                alert('‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏£‡∏π‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ');
                return;
            }
            
            const classroom = {
                id: Date.now(),
                name: name,
                teacherId: gameData.currentUser.id,
                students: [],
                createdAt: new Date().toISOString()
            };
            
            gameData.classrooms.push(classroom);
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏£‡∏π
            const teacher = gameData.teachers.find(t => t.id === gameData.currentUser.id);
            if (teacher) {
                if (!teacher.classrooms) teacher.classrooms = [];
                teacher.classrooms.push(classroom.id);
            }
            
            document.getElementById('classroomName').value = '';
            saveData();
            updateTeacherDashboard();
        }

        function selectClassroom(classroomId) {
            gameData.selectedClassroom = classroomId;
            updateTeacherDashboard();
        }

        function addStudents() {
            const classroomId = parseInt(document.getElementById('classroomSelect').value);
            const names = document.getElementById('studentNames').value.split('\n').filter(n => n.trim());
            
            if (classroomId && names.length > 0) {
                const classroom = gameData.classrooms.find(c => c.id === classroomId);
                
                names.forEach(name => {
                    const student = {
                        id: Date.now() + Math.random(),
                        name: name.trim(),
                        code: generateStudentCode(),
                        classroomId: classroomId,
                        points: 0,
                        treeType: null,
                        notifications: [],
                        garden: [], // ‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
                        needsTreeSelection: false // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    };
                    gameData.students.push(student);
                    classroom.students.push(student.id);
                });
                
                document.getElementById('studentNames').value = '';
                saveData();
                updateTeacherDashboard();
            }
        }

        function generateStudentCode() {
            return Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        function createMission() {
            const title = document.getElementById('missionTitle').value.trim();
            const description = document.getElementById('missionDescription').value.trim();
            const reward = parseInt(document.getElementById('missionReward').value);
            
            if (!title || !description || !reward || reward <= 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            if (!gameData.selectedClassroom) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            const mission = {
                id: Date.now(),
                title: title,
                description: description,
                reward: reward,
                classroomId: gameData.selectedClassroom,
                teacherId: gameData.currentUser.id,
                createdAt: new Date().toISOString(),
                active: true
            };
            
            gameData.missions.push(mission);
            
            // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            const students = gameData.students.filter(s => s.classroomId === gameData.selectedClassroom);
            students.forEach(student => {
                const notification = {
                    id: Date.now() + Math.random(),
                    message: `üéØ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÉ‡∏´‡∏°‡πà: "${title}" - ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• ${reward} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`,
                    effect: 'mission',
                    timestamp: new Date().toISOString(),
                    viewed: false,
                    missionId: mission.id
                };
                student.notifications.push(notification);
            });
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('missionTitle').value = '';
            document.getElementById('missionDescription').value = '';
            document.getElementById('missionReward').value = '';
            
            saveData();
            updateTeacherDashboard();
            alert(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à "${title}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${students.length} ‡∏Ñ‡∏ô‡πÅ‡∏•‡πâ‡∏ß`);
        }

        function createAnnouncement() {
            const title = document.getElementById('announcementTitle').value.trim();
            const message = document.getElementById('announcementMessage').value.trim();
            
            if (!title || !message) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®');
                return;
            }
            
            if (!gameData.selectedClassroom) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            const announcement = {
                id: Date.now(),
                title: title,
                message: message,
                classroomId: gameData.selectedClassroom,
                teacherId: gameData.currentUser.id,
                createdAt: new Date().toISOString()
            };
            
            gameData.announcements.push(announcement);
            
            // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            const students = gameData.students.filter(s => s.classroomId === gameData.selectedClassroom);
            students.forEach(student => {
                const notification = {
                    id: Date.now() + Math.random(),
                    message: `üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®: "${title}" - ${message}`,
                    effect: 'announcement',
                    timestamp: new Date().toISOString(),
                    viewed: false
                };
                student.notifications.push(notification);
            });
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('announcementTitle').value = '';
            document.getElementById('announcementMessage').value = '';
            
            saveData();
            alert(`‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® "${title}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${students.length} ‡∏Ñ‡∏ô‡πÅ‡∏•‡πâ‡∏ß`);
        }

        function updateTeacherDashboard() {
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏π‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö)
            const classroomsList = document.getElementById('classroomsList');
            classroomsList.innerHTML = '';
            
            const teacherClassrooms = gameData.classrooms.filter(c => c.teacherId === gameData.currentUser?.id);
            
            if (teacherClassrooms.length === 0) {
                classroomsList.innerHTML = '<div class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô<br>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!</div>';
            } else {
                teacherClassrooms.forEach(classroom => {
                    const div = document.createElement('div');
                    div.className = `p-3 rounded-xl cursor-pointer transition-all ${
                        gameData.selectedClassroom === classroom.id 
                            ? 'bg-green-500 text-white' 
                            : 'bg-white hover:bg-green-50'
                    }`;
                    div.innerHTML = `
                        <div class="font-bold">${classroom.name}</div>
                        <div class="text-sm opacity-75">${classroom.students.length} ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
                        <div class="text-xs opacity-60">${new Date(classroom.createdAt).toLocaleDateString('th-TH')}</div>
                    `;
                    div.onclick = () => selectClassroom(classroom.id);
                    classroomsList.appendChild(div);
                });
            }

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï select ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏π‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö)
            const classroomSelect = document.getElementById('classroomSelect');
            classroomSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>';
            teacherClassrooms.forEach(classroom => {
                const option = document.createElement('option');
                option.value = classroom.id;
                option.textContent = classroom.name;
                classroomSelect.appendChild(option);
            });

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏¥‡∏î‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            updateStudentsGrid();
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
            updateMissionsList();
        }

        function updateMissionsList() {
            const missionsList = document.getElementById('teacherMissionsList');
            if (!missionsList) return;
            
            missionsList.innerHTML = '';
            
            if (!gameData.selectedClassroom) {
                missionsList.innerHTML = '<div class="text-center text-gray-500 py-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</div>';
                return;
            }
            
            const missions = gameData.missions.filter(m => m.classroomId === gameData.selectedClassroom && m.active);
            
            if (missions.length === 0) {
                missionsList.innerHTML = '<div class="text-center text-gray-500 py-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</div>';
                return;
            }
            
            missions.forEach(mission => {
                const div = document.createElement('div');
                div.className = 'bg-orange-50 p-3 rounded-xl border border-orange-200';
                div.innerHTML = `
                    <div class="font-bold text-orange-800">${mission.title}</div>
                    <div class="text-sm text-orange-600 mb-2">${mission.description}</div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-bold text-green-600">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: ${mission.reward} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
                        <button onclick="showMissionCompleteModal(${mission.id})" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg text-xs font-bold">
                            ‚úÖ ‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
                        </button>
                    </div>
                `;
                missionsList.appendChild(div);
            });
        }

        function updateStudentsGrid() {
            const studentsGrid = document.getElementById('studentsGrid');
            const selectedClassroomName = document.getElementById('selectedClassroomName');
            
            if (!gameData.selectedClassroom) {
                studentsGrid.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>';
                selectedClassroomName.textContent = '';
                return;
            }

            const classroom = gameData.classrooms.find(c => c.id === gameData.selectedClassroom);
            selectedClassroomName.textContent = `- ${classroom.name}`;
            
            const students = gameData.students.filter(s => s.classroomId === gameData.selectedClassroom);
            
            if (students.length === 0) {
                studentsGrid.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</div>';
                return;
            }

            studentsGrid.innerHTML = '';
            students.forEach(student => {
                const stage = getCurrentStage(student.points);
                const div = document.createElement('div');
                div.className = 'student-card p-4 rounded-xl';
                const treeDisplayHTML = getTreeDisplay(student);
                const treeTypeName = student.treeType ? 
                    (customTreeTypes[student.treeType] ? customTreeTypes[student.treeType].name : treeTypes[student.treeType]?.name) : '';
                
                div.innerHTML = `
                    <div class="text-center">
                        <div class="text-4xl mb-2 tree-3d">${treeDisplayHTML}</div>
                        <div class="font-bold text-gray-800">${student.name}</div>
                        <div class="text-sm text-gray-600">‡∏£‡∏´‡∏±‡∏™: ${student.code}</div>
                        <div class="text-sm text-green-600 font-bold">${student.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        <div class="text-xs text-gray-500">${stage.name}</div>
                        ${treeTypeName ? `<div class="text-xs text-blue-500">${treeTypeName}</div>` : ''}
                        <button onclick="viewAsStudent('${student.id}')" class="mt-2 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-xs font-bold">
                            üëÅÔ∏è ‡∏î‡∏π‡πÅ‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                        </button>
                    </div>
                `;
                studentsGrid.appendChild(div);
            });

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï select ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥
            updateActionStudentSelect();
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö
            updateClassPositionBoard();
        }

        function updateActionStudentSelect() {
            const select = document.getElementById('actionStudentSelect');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option><option value="all">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>';
            
            if (gameData.selectedClassroom) {
                const students = gameData.students.filter(s => s.classroomId === gameData.selectedClassroom);
                students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = student.name;
                    select.appendChild(option);
                });
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï select ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏î‡πâ‡∏ß‡∏¢
            updateTreeImageStudentSelect();
        }

        function updateTreeImageStudentSelect() {
            const select = document.getElementById('treeImageStudentSelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option><option value="all">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>';
            
            if (gameData.selectedClassroom) {
                const students = gameData.students.filter(s => s.classroomId === gameData.selectedClassroom);
                students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    const treeTypeName = student.treeType ? 
                        (customTreeTypes[student.treeType] ? customTreeTypes[student.treeType].name : treeTypes[student.treeType]?.name || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö') : 
                        '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å';
                    option.textContent = `${student.name} (${treeTypeName})`;
                    select.appendChild(option);
                });
            }
        }

        function showTreeImageModal() {
            if (!gameData.selectedClassroom) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            selectedNewTreeType = null;
            document.querySelectorAll('.new-tree-selection').forEach(el => {
                el.classList.remove('border-green-500', 'bg-green-50');
            });
            
            updateTreeImageStudentSelect();
            document.getElementById('treeImageModal').classList.remove('hidden');
        }

        function closeTreeImageModal() {
            document.getElementById('treeImageModal').classList.add('hidden');
            selectedNewTreeType = null;
        }

        function selectNewTreeType(type) {
            selectedNewTreeType = type;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            document.querySelectorAll('.new-tree-selection').forEach(el => {
                el.classList.remove('border-green-500', 'bg-green-50');
            });
            
            event.target.closest('.new-tree-selection').classList.add('border-green-500', 'bg-green-50');
            
            // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
            const customSection = document.getElementById('customImageSection');
            if (type === 'custom') {
                customSection.classList.remove('hidden');
                setupCustomTreeUpload();
            } else {
                customSection.classList.add('hidden');
                document.getElementById('customTreePreview').classList.add('hidden');
            }
        }
        
        function setupCustomTreeUpload() {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö
            const stageUploads = document.getElementById('stageUploads');
            const stageUrls = document.getElementById('stageUrls');
            
            stageUploads.innerHTML = '';
            stageUrls.innerHTML = '';
            
            treeStages.forEach((stage, index) => {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
                const fileDiv = document.createElement('div');
                fileDiv.className = 'bg-white p-3 rounded-lg border border-gray-200';
                fileDiv.innerHTML = `
                    <div class="text-sm font-bold text-gray-700 mb-2">
                        ${stage.emoji} ‡∏£‡∏∞‡∏î‡∏±‡∏ö ${index + 1}: ${stage.name}
                    </div>
                    <input type="file" id="stageFile_${index}" accept="image/*" class="w-full text-xs p-2 border border-gray-200 rounded">
                `;
                stageUploads.appendChild(fileDiv);
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå URL
                const urlDiv = document.createElement('div');
                urlDiv.className = 'bg-white p-3 rounded-lg border border-gray-200';
                urlDiv.innerHTML = `
                    <div class="text-sm font-bold text-gray-700 mb-2">
                        ${stage.emoji} ‡∏£‡∏∞‡∏î‡∏±‡∏ö ${index + 1}: ${stage.name}
                    </div>
                    <input type="url" id="stageUrl_${index}" placeholder="https://example.com/stage${index + 1}.jpg" class="w-full text-sm p-2 border border-gray-200 rounded">
                `;
                stageUrls.appendChild(urlDiv);
            });
            
            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
            document.querySelectorAll('input[name="uploadMethod"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'files') {
                        document.getElementById('fileUploadSection').classList.remove('hidden');
                        document.getElementById('urlUploadSection').classList.add('hidden');
                    } else {
                        document.getElementById('fileUploadSection').classList.add('hidden');
                        document.getElementById('urlUploadSection').classList.remove('hidden');
                    }
                });
            });
        }

        function previewCustomTree() {
            const name = document.getElementById('customTreeName').value.trim();
            
            if (!name) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ');
                return;
            }
            
            const uploadMethod = document.querySelector('input[name="uploadMethod"]:checked').value;
            const preview = document.getElementById('customTreePreview');
            const previewName = document.getElementById('previewName');
            const previewStages = document.getElementById('previewStages');
            
            previewName.textContent = name;
            previewStages.innerHTML = '';
            
            let hasImages = false;
            
            if (uploadMethod === 'files') {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå
                for (let i = 0; i < treeStages.length; i++) {
                    const fileInput = document.getElementById(`stageFile_${i}`);
                    if (fileInput && fileInput.files && fileInput.files[0]) {
                        hasImages = true;
                        const file = fileInput.files[0];
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå
                        if (!file.type.startsWith('image/')) {
                            alert(`‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö ${i + 1} ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û`);
                            return;
                        }
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)
                        if (file.size > 5 * 1024 * 1024) {
                            alert(`‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö ${i + 1} ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏Å‡∏¥‡∏ô 5MB`);
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const stageDiv = document.createElement('div');
                            stageDiv.className = 'text-center';
                            stageDiv.innerHTML = `
                                <img src="${e.target.result}" class="w-12 h-12 object-cover rounded mx-auto mb-1" alt="‡∏£‡∏∞‡∏î‡∏±‡∏ö ${i + 1}">
                                <div class="text-xs text-gray-600">Lv.${i + 1}</div>
                            `;
                            previewStages.appendChild(stageDiv);
                        };
                        reader.readAsDataURL(file);
                    } else {
                        // ‡πÅ‡∏™‡∏î‡∏á placeholder ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ
                        const stageDiv = document.createElement('div');
                        stageDiv.className = 'text-center';
                        stageDiv.innerHTML = `
                            <div class="w-12 h-12 bg-gray-200 rounded mx-auto mb-1 flex items-center justify-center text-gray-400 text-xs">
                                ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ
                            </div>
                            <div class="text-xs text-gray-600">Lv.${i + 1}</div>
                        `;
                        previewStages.appendChild(stageDiv);
                    }
                }
            } else {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL
                for (let i = 0; i < treeStages.length; i++) {
                    const urlInput = document.getElementById(`stageUrl_${i}`);
                    if (urlInput && urlInput.value.trim()) {
                        hasImages = true;
                        try {
                            new URL(urlInput.value.trim());
                            const stageDiv = document.createElement('div');
                            stageDiv.className = 'text-center';
                            stageDiv.innerHTML = `
                                <img src="${urlInput.value.trim()}" class="w-12 h-12 object-cover rounded mx-auto mb-1" alt="‡∏£‡∏∞‡∏î‡∏±‡∏ö ${i + 1}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yNCAzNkMzMC42Mjc0IDM2IDM2IDMwLjYyNzQgMzYgMjRDMzYgMTcuMzcyNiAzMC42Mjc0IDEyIDI0IDEyQzE3LjM3MjYgMTIgMTIgMTcuMzcyNiAxMiAyNEMxMiAzMC42Mjc0IDE3LjM3MjYgMzYgMjQgMzZaIiBzdHJva2U9IiM5Q0EzQUYiIHN0cm9rZS13aWR0aD0iMiIvPgo8cGF0aCBkPSJNMjEgMjFMMjcgMjciIHN0cm9rZT0iIzlDQTNBRiIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPHA+PC9wYXRoPgo8L3N2Zz4K'; this.alt='‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ';">
                                <div class="text-xs text-gray-600">Lv.${i + 1}</div>
                            `;
                            previewStages.appendChild(stageDiv);
                        } catch (e) {
                            alert(`URL ‡∏£‡∏∞‡∏î‡∏±‡∏ö ${i + 1} ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
                            return;
                        }
                    } else {
                        // ‡πÅ‡∏™‡∏î‡∏á placeholder ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ URL
                        const stageDiv = document.createElement('div');
                        stageDiv.className = 'text-center';
                        stageDiv.innerHTML = `
                            <div class="w-12 h-12 bg-gray-200 rounded mx-auto mb-1 flex items-center justify-center text-gray-400 text-xs">
                                ‡πÑ‡∏°‡πà‡∏°‡∏µ URL
                            </div>
                            <div class="text-xs text-gray-600">Lv.${i + 1}</div>
                        `;
                        previewStages.appendChild(stageDiv);
                    }
                }
            }
            
            if (!hasImages) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏∞‡∏î‡∏±‡∏ö');
                return;
            }
            
            preview.classList.remove('hidden');
        }
        
        function clearCustomTree() {
            document.getElementById('customTreeName').value = '';
            document.getElementById('customTreePreview').classList.add('hidden');
            
            // ‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå
            treeStages.forEach((stage, index) => {
                const fileInput = document.getElementById(`stageFile_${index}`);
                const urlInput = document.getElementById(`stageUrl_${index}`);
                if (fileInput) fileInput.value = '';
                if (urlInput) urlInput.value = '';
            });
        }

        function createCustomTreeType() {
            const name = document.getElementById('customTreeName').value.trim();
            
            if (!name) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ');
                return null;
            }
            
            const uploadMethod = document.querySelector('input[name="uploadMethod"]:checked').value;
            const stageImages = [];
            
            if (uploadMethod === 'files') {
                // ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏ü‡∏•‡πå
                const promises = [];
                
                for (let i = 0; i < treeStages.length; i++) {
                    const fileInput = document.getElementById(`stageFile_${i}`);
                    if (fileInput && fileInput.files && fileInput.files[0]) {
                        const file = fileInput.files[0];
                        const promise = new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                resolve({ index: i, data: e.target.result });
                            };
                            reader.readAsDataURL(file);
                        });
                        promises.push(promise);
                    }
                }
                
                if (promises.length === 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏∞‡∏î‡∏±‡∏ö');
                    return null;
                }
                
                return Promise.all(promises).then(results => {
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á array ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö
                    const stageImages = new Array(treeStages.length).fill(null);
                    
                    results.forEach(result => {
                        stageImages[result.index] = result.data;
                    });
                    
                    const customId = 'custom_' + Date.now();
                    customTreeTypes[customId] = {
                        fruit: 'üå≥', // fallback
                        color: 'text-green-500',
                        name: name,
                        isCustom: true,
                        stageImages: stageImages
                    };
                    
                    return customId;
                });
                
            } else {
                // ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• URL
                const stageImages = new Array(treeStages.length).fill(null);
                let hasImages = false;
                
                for (let i = 0; i < treeStages.length; i++) {
                    const urlInput = document.getElementById(`stageUrl_${i}`);
                    if (urlInput && urlInput.value.trim()) {
                        stageImages[i] = urlInput.value.trim();
                        hasImages = true;
                    }
                }
                
                if (!hasImages) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏∞‡∏î‡∏±‡∏ö');
                    return null;
                }
                
                const customId = 'custom_' + Date.now();
                customTreeTypes[customId] = {
                    fruit: 'üå≥', // fallback
                    color: 'text-green-500',
                    name: name,
                    isCustom: true,
                    stageImages: stageImages
                };
                
                return Promise.resolve(customId);
            }
        }

        async function applyTreeImageChange() {
            const studentId = document.getElementById('treeImageStudentSelect').value;
            
            if (!studentId || !selectedNewTreeType) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ');
                return;
            }
            
            let finalTreeType = selectedNewTreeType;
            
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô custom tree ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô
            if (selectedNewTreeType === 'custom') {
                const customTreeId = await createCustomTreeType();
                if (!customTreeId) {
                    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ');
                    return;
                }
                finalTreeType = customTreeId;
            }
            
            let targetStudents = [];
            
            if (studentId === 'all') {
                targetStudents = gameData.students.filter(s => s.classroomId === gameData.selectedClassroom);
            } else {
                const student = gameData.students.find(s => s.id == studentId);
                if (student) targetStudents = [student];
            }
            
            targetStudents.forEach(student => {
                const oldTreeType = student.treeType;
                student.treeType = finalTreeType;
                
                // ‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ
                const treeTypeName = customTreeTypes[finalTreeType] ? 
                    customTreeTypes[finalTreeType].name : 
                    treeTypes[finalTreeType].name;
                
                // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                const notification = {
                    id: Date.now() + Math.random(),
                    message: `üé® ‡∏Ñ‡∏£‡∏π‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô${treeTypeName}‡πÅ‡∏•‡πâ‡∏ß!`,
                    effect: 'tree_change',
                    timestamp: new Date().toISOString(),
                    viewed: false
                };
                student.notifications.push(notification);
            });
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å custom tree types
            gameData.customTreeTypes = customTreeTypes;
            saveData();
            updateStudentsGrid();
            closeTreeImageModal();
            
            const treeTypeName = customTreeTypes[finalTreeType] ? 
                customTreeTypes[finalTreeType].name : 
                treeTypes[finalTreeType].name;
            alert(`‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÄ‡∏õ‡πá‡∏ô${treeTypeName}‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${targetStudents.length} ‡∏Ñ‡∏ô ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
        }

        function updateClassPositionBoard() {
            const positionBoard = document.getElementById('classPositionBoard');
            
            if (!gameData.selectedClassroom) {
                positionBoard.innerHTML = '<div class="text-center text-gray-500 py-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</div>';
                return;
            }
            
            const students = gameData.students.filter(s => s.classroomId === gameData.selectedClassroom);
            
            if (students.length === 0) {
                positionBoard.innerHTML = '<div class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</div>';
                return;
            }
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            const sortedStudents = students.sort((a, b) => b.points - a.points);
            
            positionBoard.innerHTML = '';
            
            sortedStudents.forEach((student, index) => {
                const stage = getCurrentStage(student.points);
                const position = index + 1;
                
                const div = document.createElement('div');
                div.className = `flex items-center justify-between p-3 rounded-lg mb-2 ${
                    position === 1 ? 'bg-gradient-to-r from-yellow-200 to-yellow-300 border-2 border-yellow-400' :
                    position === 2 ? 'bg-gradient-to-r from-gray-200 to-gray-300 border-2 border-gray-400' :
                    position === 3 ? 'bg-gradient-to-r from-orange-200 to-orange-300 border-2 border-orange-400' :
                    'bg-white border border-gray-200'
                }`;
                
                const rankEmoji = position === 1 ? 'ü•á' : position === 2 ? 'ü•à' : position === 3 ? 'ü•â' : `#${position}`;
                
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="text-lg font-bold ${position <= 3 ? 'text-2xl' : 'text-gray-600'}">${rankEmoji}</div>
                        <div>
                            <div class="font-bold text-gray-800">${student.name}</div>
                            <div class="text-sm text-gray-600">Lv.${treeStages.indexOf(stage) + 1} - ${stage.name}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-bold text-green-600">${student.points}</div>
                        <div class="text-xs text-gray-500">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                    </div>
                `;
                
                positionBoard.appendChild(div);
            });
        }

        function showActionModal(actionType) {
            if (!gameData.selectedClassroom) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            currentAction = actionType;
            const action = actions[actionType];
            document.getElementById('actionTitle').textContent = `${action.title} (${action.points > 0 ? '+' : ''}${action.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)`;
            document.getElementById('actionModal').classList.remove('hidden');
        }

        function closeActionModal() {
            document.getElementById('actionModal').classList.add('hidden');
            currentAction = null;
        }

        function applyAction() {
            const studentId = document.getElementById('actionStudentSelect').value;
            
            if (!studentId || !currentAction) return;
            
            const action = actions[currentAction];
            let targetStudents = [];
            
            if (studentId === 'all') {
                targetStudents = gameData.students.filter(s => s.classroomId === gameData.selectedClassroom);
            } else {
                const student = gameData.students.find(s => s.id == studentId);
                if (student) targetStudents = [student];
            }
            
            targetStudents.forEach(student => {
                const oldPoints = student.points;
                student.points = Math.max(0, student.points + action.points);
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö
                const oldStage = getCurrentStage(oldPoints);
                const newStage = getCurrentStage(student.points);
                
                const notification = {
                    id: Date.now() + Math.random(),
                    message: action.message,
                    effect: action.effect,
                    timestamp: new Date().toISOString(),
                    viewed: false
                };
                student.notifications.push(notification);
                
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©
                if (newStage.points > oldStage.points) {
                    const levelUpNotification = {
                        id: Date.now() + Math.random() + 1,
                        message: `üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô "${newStage.name}" ‡πÅ‡∏•‡πâ‡∏ß! ‚ú®`,
                        effect: 'levelup',
                        timestamp: new Date().toISOString(),
                        viewed: false
                    };
                    student.notifications.push(levelUpNotification);
                }
                
                // ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö 12 ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà
                if (newStage.level >= 12 && oldStage.level < 12) {
                    student.needsTreeSelection = true;
                    
                    const newTreeNotification = {
                        id: Date.now() + Math.random() + 2,
                        message: `üåü ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà üå±`,
                        effect: 'newtree',
                        timestamp: new Date().toISOString(),
                        viewed: false
                    };
                    student.notifications.push(newTreeNotification);
                }
            });
            
            saveData();
            updateStudentsGrid();
            closeActionModal();
            
            alert(`‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥ "${action.title}" ‡∏Å‡∏±‡∏ö ${targetStudents.length} ‡∏Ñ‡∏ô ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
        }

        function showMissionCompleteModal(missionId) {
            const mission = gameData.missions.find(m => m.id === missionId);
            if (!mission) return;
            
            gameData.selectedMission = missionId;
            document.getElementById('missionCompleteTitle').textContent = `‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ${mission.title}`;
            document.getElementById('missionCompleteInfo').textContent = `‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: ${mission.reward} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï select ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            const select = document.getElementById('missionCompleteStudentSelect');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option><option value="all">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>';
            
            const students = gameData.students.filter(s => s.classroomId === gameData.selectedClassroom);
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                select.appendChild(option);
            });
            
            document.getElementById('missionCompleteModal').classList.remove('hidden');
        }

        function closeMissionCompleteModal() {
            document.getElementById('missionCompleteModal').classList.add('hidden');
            gameData.selectedMission = null;
        }

        function completeMission() {
            const studentId = document.getElementById('missionCompleteStudentSelect').value;
            const mission = gameData.missions.find(m => m.id === gameData.selectedMission);
            
            if (!studentId || !mission) return;
            
            let targetStudents = [];
            
            if (studentId === 'all') {
                targetStudents = gameData.students.filter(s => s.classroomId === gameData.selectedClassroom);
            } else {
                const student = gameData.students.find(s => s.id == studentId);
                if (student) targetStudents = [student];
            }
            
            targetStudents.forEach(student => {
                const oldPoints = student.points;
                student.points = Math.max(0, student.points + mission.reward);
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö
                const oldStage = getCurrentStage(oldPoints);
                const newStage = getCurrentStage(student.points);
                
                const notification = {
                    id: Date.now() + Math.random(),
                    message: `üéâ ‡∏ó‡∏≥‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à "${mission.title}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${mission.reward} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`,
                    effect: 'mission_complete',
                    timestamp: new Date().toISOString(),
                    viewed: false
                };
                student.notifications.push(notification);
                
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©
                if (newStage.points > oldStage.points) {
                    const levelUpNotification = {
                        id: Date.now() + Math.random() + 1,
                        message: `üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô "${newStage.name}" ‡πÅ‡∏•‡πâ‡∏ß! ‚ú®`,
                        effect: 'levelup',
                        timestamp: new Date().toISOString(),
                        viewed: false
                    };
                    student.notifications.push(levelUpNotification);
                }
                
                // ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö 12 ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà
                if (newStage.level >= 12 && oldStage.level < 12) {
                    student.needsTreeSelection = true;
                    
                    const newTreeNotification = {
                        id: Date.now() + Math.random() + 2,
                        message: `üåü ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà üå±`,
                        effect: 'newtree',
                        timestamp: new Date().toISOString(),
                        viewed: false
                    };
                    student.notifications.push(newTreeNotification);
                }
            });
            
            saveData();
            updateStudentsGrid();
            closeMissionCompleteModal();
            
            alert(`‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à "${mission.title}" ‡∏Å‡∏±‡∏ö ${targetStudents.length} ‡∏Ñ‡∏ô ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
        }

        function showMissions() {
            const student = gameData.currentStudent;
            if (!student) return;
            
            const modal = document.getElementById('missionModal');
            const list = modal.querySelector('#missionsList');
            
            list.innerHTML = '';
            
            const missions = gameData.missions.filter(m => m.classroomId === student.classroomId && m.active);
            
            if (missions.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</div>';
            } else {
                missions.forEach(mission => {
                    const div = document.createElement('div');
                    div.className = 'p-4 rounded-xl border-2 bg-orange-50 border-orange-200';
                    div.innerHTML = `
                        <div class="font-bold text-orange-800 mb-2">${mission.title}</div>
                        <div class="text-gray-700 mb-3">${mission.description}</div>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-green-600">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: ${mission.reward} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
                            <span class="text-sm text-gray-500">${new Date(mission.createdAt).toLocaleDateString('th-TH')}</span>
                        </div>
                    `;
                    list.appendChild(div);
                });
            }
            
            modal.classList.remove('hidden');
            updateMissionBadge();
        }

        function closeMissionModal() {
            document.getElementById('missionModal').classList.add('hidden');
        }

        function updateMissionBadge() {
            const student = gameData.currentStudent;
            if (!student) return;
            
            const missions = gameData.missions.filter(m => m.classroomId === student.classroomId && m.active);
            const badge = document.getElementById('missionBadge');
            
            if (missions.length > 0) {
                badge.textContent = missions.length;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function showWheelModal() {
            if (!gameData.selectedClassroom) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            const students = gameData.students.filter(s => s.classroomId === gameData.selectedClassroom);
            if (students.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ');
                return;
            }
            
            document.getElementById('wheelModal').classList.remove('hidden');
            document.getElementById('wheelResult').classList.add('hidden');
            document.getElementById('spinButton').disabled = false;
            document.getElementById('spinButton').textContent = 'üé≤ ‡∏´‡∏°‡∏∏‡∏ô‡∏ß‡∏á‡∏•‡πâ‡∏≠';
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏á‡∏•‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà
            drawWheel(students);
        }

        function closeWheelModal() {
            document.getElementById('wheelModal').classList.add('hidden');
        }

        function drawWheel(students) {
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            const container = document.getElementById('wheelContainer');
            const maxSize = Math.min(window.innerWidth - 100, window.innerHeight - 200, 500);
            const wheelSize = Math.max(300, maxSize);
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á container ‡πÅ‡∏•‡∏∞ canvas
            container.style.width = wheelSize + 'px';
            container.style.height = wheelSize + 'px';
            
            const wheelCanvas = document.getElementById('wheelCanvas');
            wheelCanvas.style.width = wheelSize + 'px';
            wheelCanvas.style.height = wheelSize + 'px';
            
            const canvas = document.getElementById('wheelSegments');
            canvas.width = wheelSize * 2; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
            canvas.height = wheelSize * 2;
            canvas.style.width = wheelSize + 'px';
            canvas.style.height = wheelSize + 'px';
            
            const ctx = canvas.getContext('2d');
            ctx.scale(2, 2); // ‡∏õ‡∏£‡∏±‡∏ö scale ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°‡∏ä‡∏±‡∏î
            
            const centerX = wheelSize / 2;
            const centerY = wheelSize / 2;
            const radius = (wheelSize / 2) - 25;
            
            // ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡∏ô‡∏ß‡∏≤‡∏™
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°‡∏ä‡∏±‡∏î
            const colors = [
                '#FF6B9D', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', 
                '#DDA0DD', '#98D8C8', '#F7DC6F', '#FF8A80', '#81C784',
                '#FFB74D', '#E57373', '#64B5F6', '#AED581', '#FFD54F',
                '#F06292', '#4DB6AC', '#7986CB', '#A1C181', '#FFCC80'
            ];
            
            const anglePerSegment = (2 * Math.PI) / students.length;
            
            // ‡∏ß‡∏≤‡∏î‡πÄ‡∏á‡∏≤‡∏Ç‡∏≠‡∏á‡∏ß‡∏á‡∏•‡πâ‡∏≠
            ctx.save();
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.shadowBlur = 15;
            ctx.shadowOffsetX = 5;
            ctx.shadowOffsetY = 5;
            
            // ‡∏ß‡∏≤‡∏î‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.fillStyle = '#ffffff';
            ctx.fill();
            ctx.restore();
            
            // ‡∏ß‡∏≤‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ß‡∏á‡∏•‡πâ‡∏≠
            students.forEach((student, index) => {
                const startAngle = index * anglePerSegment - Math.PI / 2;
                const endAngle = (index + 1) * anglePerSegment - Math.PI / 2;
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á gradient ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô
                const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
                const baseColor = colors[index % colors.length];
                gradient.addColorStop(0, lightenColor(baseColor, 20));
                gradient.addColorStop(0.7, baseColor);
                gradient.addColorStop(1, darkenColor(baseColor, 20));
                
                // ‡∏ß‡∏≤‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÇ‡∏Ñ‡πâ‡∏á
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏´‡∏ô‡∏≤
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 4;
                ctx.stroke();
                
                // ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ö‡∏≤‡∏á ‡πÜ
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 1;
                ctx.stroke();
                
                // ‡∏ß‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + anglePerSegment / 2);
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏ï‡∏≤‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏ß‡∏á‡∏•‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                const baseFontSize = Math.max(14, Math.min(24, wheelSize / 18));
                const adjustedFontSize = students.length > 15 ? baseFontSize * 0.7 : 
                                       students.length > 10 ? baseFontSize * 0.85 : baseFontSize;
                
                // ‡∏ï‡∏±‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡πâ‡∏≤‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
                let displayName = student.name;
                const maxLength = students.length > 15 ? 5 : students.length > 10 ? 7 : 12;
                if (displayName.length > maxLength) {
                    displayName = displayName.substring(0, maxLength) + '...';
                }
                
                // ‡∏ß‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                ctx.font = `bold ${adjustedFontSize}px Kanit, sans-serif`;
                const textRadius = radius * 0.68;
                
                // ‡πÄ‡∏á‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
                ctx.shadowBlur = 4;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                
                // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏î‡∏≥‡∏´‡∏ô‡∏≤
                ctx.fillStyle = '#ffffff';
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 4;
                ctx.strokeText(displayName, textRadius, 0);
                ctx.fillText(displayName, textRadius, 0);
                
                ctx.restore();
            });
            
            // ‡∏ß‡∏≤‡∏î‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°
            const centerRadius = Math.max(25, wheelSize / 12);
            
            // ‡πÄ‡∏á‡∏≤‡∏Ç‡∏≠‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏Å‡∏•‡∏≤‡∏á
            ctx.save();
            ctx.shadowColor = 'rgba(0, 0, 0, 0.4)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            
            // ‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ö‡∏ö gradient
            const centerGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, centerRadius);
            centerGradient.addColorStop(0, '#FFD700');
            centerGradient.addColorStop(0.3, '#FFA500');
            centerGradient.addColorStop(1, '#FF8C00');
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, centerRadius, 0, 2 * Math.PI);
            ctx.fillStyle = centerGradient;
            ctx.fill();
            
            // ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏Å‡∏•‡∏≤‡∏á
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 4;
            ctx.stroke();
            
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.restore();
            
            // ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô
            ctx.font = `${centerRadius}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = '#ffffff';
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.strokeText('üéØ', centerX, centerY);
            ctx.fillText('üéØ', centerX, centerY);
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤
            document.getElementById('wheelNames').innerHTML = '';
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ
        function lightenColor(color, percent) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }
        
        function darkenColor(color, percent) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) - amt;
            const G = (num >> 8 & 0x00FF) - amt;
            const B = (num & 0x0000FF) - amt;
            return "#" + (0x1000000 + (R > 255 ? 255 : R < 0 ? 0 : R) * 0x10000 +
                (G > 255 ? 255 : G < 0 ? 0 : G) * 0x100 +
                (B > 255 ? 255 : B < 0 ? 0 : B)).toString(16).slice(1);
        }

        function spinWheel() {
            const allStudents = gameData.students.filter(s => s.classroomId === gameData.selectedClassroom);
            if (allStudents.length === 0) return;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ
            const classroomId = gameData.selectedClassroom;
            if (!gameData.wheelHistory[classroomId]) {
                gameData.wheelHistory[classroomId] = {
                    availableStudents: [...allStudents.map(s => s.id)],
                    usedStudents: []
                };
            }
            
            const wheelHistory = gameData.wheelHistory[classroomId];
            
            // ‡∏ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
            if (wheelHistory.availableStudents.length === 0) {
                wheelHistory.availableStudents = [...allStudents.map(s => s.id)];
                wheelHistory.usedStudents = [];
                
                // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
                showFloatingNotification('üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà! ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏´‡∏°‡πà', 'info');
            }
            
            // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const availableStudents = allStudents.filter(s => wheelHistory.availableStudents.includes(s.id));
            
            const spinButton = document.getElementById('spinButton');
            spinButton.disabled = true;
            spinButton.textContent = 'üåÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏°‡∏∏‡∏ô...';
            
            const wheel = document.getElementById('wheelCanvas');
            const wheelResult = document.getElementById('wheelResult');
            wheelResult.classList.add('hidden');
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏Ç‡∏ì‡∏∞‡∏´‡∏°‡∏∏‡∏ô
            wheel.classList.add('wheel-spinning', 'wheel-glow');
            
            // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏°‡∏∏‡∏ô
            if (gameData.settings.soundEnabled) {
                playSound('spin');
            }
            
            // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const winnerIndex = Math.floor(Math.random() * availableStudents.length);
            const winner = availableStudents[winnerIndex];
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏´‡∏¢‡∏∏‡∏î (‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞)
            const allStudentIndex = allStudents.findIndex(s => s.id === winner.id);
            const segmentAngle = 360 / allStudents.length;
            const targetAngle = (allStudentIndex * segmentAngle) + (segmentAngle / 2);
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á
            const spins = 6 + Math.random() * 4; // 6-10 ‡∏£‡∏≠‡∏ö
            const finalAngle = 360 - targetAngle; // ‡∏´‡∏°‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
            const totalRotation = spins * 360 + finalAngle;
            
            // ‡πÉ‡∏ä‡πâ CSS animation ‡πÅ‡∏ö‡∏ö smooth
            wheel.style.transition = 'transform 4.5s cubic-bezier(0.23, 1, 0.32, 1)';
            wheel.style.transform = `rotate(${totalRotation}deg)`;
            
            // ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏°‡∏∏‡∏ô
            let spinSoundInterval;
            if (gameData.settings.soundEnabled) {
                spinSoundInterval = setInterval(() => {
                    playTone(new (window.AudioContext || window.webkitAudioContext)(), 
                           200 + Math.random() * 100, 0.05, 0.1);
                }, 100);
            }
            
            setTimeout(() => {
                // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏°‡∏∏‡∏ô
                if (spinSoundInterval) {
                    clearInterval(spinSoundInterval);
                }
                
                // ‡∏•‡∏ö‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏´‡∏°‡∏∏‡∏ô
                wheel.classList.remove('wheel-spinning');
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô
                wheelHistory.availableStudents = wheelHistory.availableStudents.filter(id => id !== winner.id);
                wheelHistory.usedStudents.push(winner.id);
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå
                setTimeout(() => {
                    wheel.classList.remove('wheel-glow');
                    document.getElementById('winnerName').textContent = winner.name;
                    wheelResult.classList.remove('hidden');
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ä‡∏ô‡∏∞
                    wheelResult.style.animation = 'bounceIn 0.8s ease-out';
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏∏‡πà‡∏°
                    const remainingCount = wheelHistory.availableStudents.length;
                    if (remainingCount > 0) {
                        spinButton.textContent = `üé≤ ‡∏´‡∏°‡∏∏‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${remainingCount} ‡∏Ñ‡∏ô)`;
                    } else {
                        spinButton.textContent = 'üéâ ‡∏´‡∏°‡∏∏‡∏ô‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà';
                    }
                    spinButton.disabled = false;
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ
                    wheel.style.transition = 'none';
                    wheel.style.transform = `rotate(${finalAngle}deg)`;
                    
                    // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞
                    const notification = {
                        id: Date.now(),
                        message: `üéØ ‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠! ‡∏Ñ‡∏£‡∏π‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏∏‡∏ì ‚ú®`,
                        effect: 'winner',
                        timestamp: new Date().toISOString(),
                        viewed: false
                    };
                    winner.notifications.push(notification);
                    saveData();
                    
                    // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ä‡∏ô‡∏∞
                    if (gameData.settings.soundEnabled) {
                        playSound('win');
                    }
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏•‡∏∏
                    createWheelFireworks();
                }, 300);
            }, 4500);
        }
        
        function createWheelFireworks() {
            const wheelContainer = document.querySelector('.wheel-container');
            const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD'];
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.style.position = 'absolute';
                    firework.style.width = '6px';
                    firework.style.height = '6px';
                    firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    firework.style.borderRadius = '50%';
                    firework.style.left = '50%';
                    firework.style.top = '50%';
                    firework.style.pointerEvents = 'none';
                    firework.style.animation = `fireworkExplode 1.5s ease-out forwards`;
                    
                    const angle = (Math.PI * 2 * i) / 30;
                    const distance = 100 + Math.random() * 50;
                    firework.style.setProperty('--end-x', Math.cos(angle) * distance + 'px');
                    firework.style.setProperty('--end-y', Math.sin(angle) * distance + 'px');
                    
                    wheelContainer.appendChild(firework);
                    
                    setTimeout(() => {
                        if (firework.parentNode) {
                            firework.parentNode.removeChild(firework);
                        }
                    }, 1500);
                }, i * 30);
            }
        }

        function showFloatingNotification(message, type = 'success') {
            const container = document.getElementById('floatingNotifications');
            const notification = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'error' ? 'bg-red-500' : 
                           type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';
            
            notification.className = `${bgColor} text-white px-6 py-3 rounded-xl shadow-lg notification-slide mb-2`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 4 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOutRight 0.5s ease-in forwards';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 500);
                }
            }, 4000);
        }

        function updateStudentDashboard() {
            const student = gameData.currentStudent;
            if (!student) return;

            document.getElementById('studentWelcome').textContent = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, ${student.name}!`;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const currentStage = getCurrentStage(student.points);
            if (!student.treeType || student.needsTreeSelection || currentStage.level >= 12) {
                document.getElementById('treeSelection').classList.remove('hidden');
            } else {
                document.getElementById('treeSelection').classList.add('hidden');
            }

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤
            const stage = getCurrentStage(student.points);
            const nextStage = getNextStage(student.points);
            
            document.getElementById('studentProgress').textContent = `Lv.${treeStages.indexOf(stage) + 1} - ${stage.name}`;
            document.getElementById('currentPoints').textContent = `${student.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
            document.getElementById('levelBadge').textContent = `Lv.${treeStages.indexOf(stage) + 1}`;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á
            updateStudentPosition();
            
            if (nextStage) {
                document.getElementById('nextLevel').textContent = `‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ${nextStage.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
                const progress = ((student.points - stage.points) / (nextStage.points - stage.points)) * 100;
                document.getElementById('progressBar').style.width = `${Math.min(100, Math.max(0, progress))}%`;
            } else {
                document.getElementById('nextLevel').textContent = '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß!';
                document.getElementById('progressBar').style.width = '100%';
            }

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ
            const treeDisplayElement = document.getElementById('treeDisplay');
            const treeDisplayHTML = getTreeDisplay(student);
            
            if (typeof treeDisplayHTML === 'string' && treeDisplayHTML.includes('<div')) {
                treeDisplayElement.innerHTML = treeDisplayHTML;
            } else {
                treeDisplayElement.textContent = treeDisplayHTML;
            }
            
            document.getElementById('treeInfo').textContent = `${stage.name} - ${stage.description}`;

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            updateNotificationBadge();
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
            updateMissionBadge();
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ß‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ
            updateGarden();
        }

        function updateGarden() {
            const student = gameData.currentStudent;
            if (!student || !student.garden || student.garden.length === 0) {
                document.getElementById('gardenSection').classList.add('hidden');
                return;
            }
            
            document.getElementById('gardenSection').classList.remove('hidden');
            document.getElementById('gardenCount').textContent = `${student.garden.length} ‡∏ï‡πâ‡∏ô`;
            
            const gardenGrid = document.getElementById('gardenGrid');
            gardenGrid.innerHTML = '';
            
            student.garden.forEach((tree, index) => {
                const treeType = customTreeTypes[tree.type] || treeTypes[tree.type];
                const div = document.createElement('div');
                div.className = 'glass-card p-4 rounded-xl text-center hover:scale-105 transition-all cursor-pointer';
                
                const completedDate = new Date(tree.completedAt).toLocaleDateString('th-TH');
                
                div.innerHTML = `
                    <div class="text-4xl mb-2">${treeType ? treeType.fruit : 'üå≥'}</div>
                    <div class="font-bold text-sm ${treeType ? treeType.color : 'text-green-600'}">${treeType ? treeType.name : '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ'}</div>
                    <div class="text-xs text-gray-500 mt-1">Lv.${tree.level}</div>
                    <div class="text-xs text-gray-400">${completedDate}</div>
                    <div class="text-xs text-purple-600 font-bold">${tree.finalPoints} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                `;
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å
                div.onclick = () => {
                    showFloatingNotification(`üåü ${treeType ? treeType.name : '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ'} ‡∏£‡∏∞‡∏î‡∏±‡∏ö ${tree.level} - ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠ ${completedDate}`, 'info');
                    div.style.animation = 'bounceIn 0.5s ease-out';
                    setTimeout(() => {
                        div.style.animation = '';
                    }, 500);
                };
                
                gardenGrid.appendChild(div);
            });
        }

        function updateStudentPosition() {
            const student = gameData.currentStudent;
            if (!student) return;
            
            // ‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
            const classmates = gameData.students.filter(s => s.classroomId === student.classroomId);
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            const sortedStudents = classmates.sort((a, b) => b.points - a.points);
            
            // ‡∏´‡∏≤‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            const position = sortedStudents.findIndex(s => s.id === student.id) + 1;
            const totalStudents = classmates.length;
            
            // ‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            const classroom = gameData.classrooms.find(c => c.id === student.classroomId);
            const classroomName = classroom ? classroom.name : '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            const positionElement = document.getElementById('studentPosition');
            let positionText = '';
            let positionEmoji = '';
            
            if (position === 1) {
                positionEmoji = 'ü•á';
                positionText = `${positionEmoji} ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${position} ‡πÉ‡∏ô${classroomName} (${totalStudents} ‡∏Ñ‡∏ô)`;
            } else if (position === 2) {
                positionEmoji = 'ü•à';
                positionText = `${positionEmoji} ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${position} ‡πÉ‡∏ô${classroomName} (${totalStudents} ‡∏Ñ‡∏ô)`;
            } else if (position === 3) {
                positionEmoji = 'ü•â';
                positionText = `${positionEmoji} ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${position} ‡πÉ‡∏ô${classroomName} (${totalStudents} ‡∏Ñ‡∏ô)`;
            } else {
                positionEmoji = 'üèÜ';
                positionText = `${positionEmoji} ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${position} ‡πÉ‡∏ô${classroomName} (${totalStudents} ‡∏Ñ‡∏ô)`;
            }
            
            positionElement.textContent = positionText;
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö
            positionElement.className = position <= 3 ? 
                'text-yellow-600 font-bold text-lg' : 
                'text-purple-600 font-bold';
        }

        function selectTree(type) {
            const student = gameData.currentStudent;
            const currentStage = getCurrentStage(student.points);
            
            // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö 12 ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ß‡∏ô
            if (student.treeType && currentStage.level >= 12) {
                if (!student.garden) student.garden = [];
                
                const completedTree = {
                    type: student.treeType,
                    completedAt: new Date().toISOString(),
                    finalPoints: student.points,
                    level: currentStage.level,
                    name: currentStage.name
                };
                
                student.garden.push(completedTree);
                
                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà
                student.points = 0;
                
                // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ß‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                const treeTypeName = customTreeTypes[student.treeType] ? 
                    customTreeTypes[student.treeType].name : 
                    treeTypes[student.treeType]?.name || '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ';
                
                showFloatingNotification(`üåü ${treeTypeName}‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ß‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
            }
            
            // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà
            student.treeType = type;
            student.needsTreeSelection = false;
            
            const newTreeTypeName = customTreeTypes[type] ? 
                customTreeTypes[type].name : 
                treeTypes[type]?.name || '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ';
            
            showFloatingNotification(`üå± ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏•‡∏π‡∏Å${newTreeTypeName}‡πÉ‡∏´‡∏°‡πà! ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ`, 'success');
            
            saveData();
            updateStudentDashboard();
        }

        function getCurrentStage(points) {
            for (let i = treeStages.length - 1; i >= 0; i--) {
                if (points >= treeStages[i].points) {
                    return treeStages[i];
                }
            }
            return treeStages[0];
        }

        function getNextStage(points) {
            for (let i = 0; i < treeStages.length; i++) {
                if (points < treeStages[i].points) {
                    return treeStages[i];
                }
            }
            return null;
        }

        function getTreeDisplay(student) {
            if (!student.treeType) return 'üå±';
            
            const stage = getCurrentStage(student.points);
            const stageIndex = treeStages.indexOf(stage);
            let treeType = treeTypes[student.treeType] || customTreeTypes[student.treeType];
            
            if (!treeType) {
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö tree type ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ default
                treeType = { fruit: 'üå≥', name: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ' };
            }
            
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô custom tree ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö
            if (treeType.isCustom && treeType.stageImages && treeType.stageImages[stageIndex]) {
                const imageData = treeType.stageImages[stageIndex];
                return `<div class="inline-block"><img src="${imageData}" class="w-20 h-20 md:w-24 md:h-24 object-cover rounded-lg" alt="${treeType.name} ‡∏£‡∏∞‡∏î‡∏±‡∏ö ${stageIndex + 1}" onerror="this.src='üå≥'; this.alt='‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ';"></div>`;
            }
            
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô custom tree ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤ (‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
            if (treeType.isCustom && treeType.fruit.includes('<img')) {
                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö custom tree ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á
                if (stage.points >= 200) {
                    return `<div class="inline-block">${treeType.fruit}</div>`;
                } else {
                    return stage.emoji; // ‡πÅ‡∏™‡∏î‡∏á emoji ‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡πà‡∏≥
                }
            }
            
            return stage.emoji.replace(/üçé/g, treeType.fruit);
        }

        function updateNotificationBadge() {
            const student = gameData.currentStudent;
            if (!student) return;
            
            const unreadCount = student.notifications.filter(n => !n.viewed).length;
            const badge = document.getElementById('notificationBadge');
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function showNotifications() {
            const student = gameData.currentStudent;
            if (!student) return;
            
            const modal = document.getElementById('notificationModal');
            const list = document.getElementById('notificationsList');
            
            list.innerHTML = '';
            
            if (student.notifications.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>';
            } else {
                student.notifications.slice().reverse().forEach(notification => {
                    const div = document.createElement('div');
                    div.className = `p-4 rounded-xl border-2 cursor-pointer transition-all ${
                        notification.viewed ? 'bg-gray-50 border-gray-200' : 'bg-blue-50 border-blue-300'
                    }`;
                    div.innerHTML = `
                        <div class="font-bold text-gray-800">${notification.message}</div>
                        <div class="text-sm text-gray-600 mt-1">
                            ${new Date(notification.timestamp).toLocaleString('th-TH')}
                        </div>
                        <div class="text-sm text-blue-600 mt-2">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå!</div>
                    `;
                    div.onclick = () => {
                        notification.viewed = true;
                        saveData();
                        updateNotificationBadge();
                        playEffect(notification.effect);
                        // ‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î modal ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏Å‡πà‡∏≠‡∏ô
                        setTimeout(() => {
                            closeNotificationModal();
                        }, 500);
                    };
                    list.appendChild(div);
                });
            }
            
            modal.classList.remove('hidden');
        }

        function closeNotificationModal() {
            document.getElementById('notificationModal').classList.add('hidden');
        }

        function playEffect(effectType) {
            const treeDisplay = document.getElementById('treeDisplay');
            const effectOverlay = document.getElementById('effectOverlay');
            
            // ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏Å‡πà‡∏≤
            effectOverlay.innerHTML = '';
            treeDisplay.classList.remove('sick-effect');
            
            setTimeout(() => {
                switch(effectType) {
                    case 'water':
                        const waterDiv = document.createElement('div');
                        waterDiv.className = 'water-effect';
                        effectOverlay.appendChild(waterDiv);
                        
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏¢‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏¢‡∏î
                        for (let i = 0; i < 5; i++) {
                            setTimeout(() => {
                                const drop = document.createElement('div');
                                drop.className = 'water-drop';
                                drop.style.left = (40 + Math.random() * 20) + '%';
                                drop.style.animationDelay = (Math.random() * 0.5) + 's';
                                waterDiv.appendChild(drop);
                            }, i * 200);
                        }
                        playSound('water');
                        break;
                        
                    case 'fertilizer':
                        const fertilizerDiv = document.createElement('div');
                        fertilizerDiv.className = 'fertilizer-effect';
                        effectOverlay.appendChild(fertilizerDiv);
                        
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏¢‡∏î‡∏õ‡∏∏‡πã‡∏¢‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏¢‡∏î
                        for (let i = 0; i < 4; i++) {
                            setTimeout(() => {
                                const drop = document.createElement('div');
                                drop.className = 'fertilizer-drop';
                                drop.style.left = (35 + Math.random() * 30) + '%';
                                drop.style.animationDelay = (Math.random() * 0.3) + 's';
                                fertilizerDiv.appendChild(drop);
                            }, i * 300);
                        }
                        playSound('fertilizer');
                        break;
                        
                    case 'rain':
                        const rainDiv = document.createElement('div');
                        rainDiv.className = 'rain-effect';
                        effectOverlay.appendChild(rainDiv);
                        
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏¢‡∏î‡∏ù‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏¢‡∏î
                        for (let i = 0; i < 15; i++) {
                            setTimeout(() => {
                                const drop = document.createElement('div');
                                drop.className = 'rain-drop';
                                drop.style.left = Math.random() * 100 + '%';
                                drop.style.animationDelay = (Math.random() * 0.5) + 's';
                                rainDiv.appendChild(drop);
                            }, i * 100);
                        }
                        playSound('rain');
                        break;
                        
                    case 'worm':
                        const wormDiv = document.createElement('div');
                        wormDiv.className = 'worm-effect';
                        effectOverlay.appendChild(wormDiv);
                        
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏≠‡∏ô
                        const worm = document.createElement('div');
                        worm.className = 'worm-body';
                        worm.style.left = '20%';
                        worm.style.top = '70%';
                        wormDiv.appendChild(worm);
                        playSound('worm');
                        break;
                        
                    case 'sick':
                        treeDisplay.classList.add('sick-effect');
                        playSound('sick');
                        break;
                        
                    case 'storm':
                        const stormDiv = document.createElement('div');
                        stormDiv.className = 'storm-effect';
                        effectOverlay.appendChild(stormDiv);
                        
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        for (let i = 0; i < 3; i++) {
                            setTimeout(() => {
                                const lightning = document.createElement('div');
                                lightning.className = 'lightning';
                                lightning.style.left = (20 + Math.random() * 60) + '%';
                                lightning.style.top = '10%';
                                lightning.style.animationDelay = (Math.random() * 0.2) + 's';
                                stormDiv.appendChild(lightning);
                                
                                // ‡∏•‡∏ö‡∏ü‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
                                setTimeout(() => {
                                    if (lightning.parentNode) {
                                        lightning.parentNode.removeChild(lightning);
                                    }
                                }, 500);
                            }, i * 600);
                        }
                        playSound('storm');
                        break;
                        
                    case 'levelup':
                        treeDisplay.classList.add('level-up-animation');
                        createConfetti();
                        playSound('levelup');
                        setTimeout(() => {
                            treeDisplay.classList.add('tree-transition');
                        }, 500);
                        break;
                        
                    case 'newtree':
                        createConfetti();
                        playSound('win');
                        setTimeout(() => {
                            updateStudentDashboard(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà
                        }, 1000);
                        break;
                        
                    case 'winner':
                        treeDisplay.classList.add('level-up-animation');
                        createConfetti();
                        playSound('winner');
                        break;
                        
                    case 'mission':
                        treeDisplay.classList.add('pulse-glow');
                        createSparkles();
                        playSound('mission');
                        break;
                        
                    case 'mission_complete':
                        treeDisplay.classList.add('level-up-animation');
                        createConfetti();
                        playSound('mission_complete');
                        break;
                        
                    case 'announcement':
                        treeDisplay.classList.add('floating');
                        createNotificationEffect();
                        playSound('announcement');
                        break;
                        
                    case 'tree_change':
                        treeDisplay.classList.add('level-up-animation');
                        createTreeChangeEffect();
                        playSound('tree_change');
                        setTimeout(() => {
                            updateStudentDashboard(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà
                        }, 1000);
                        break;
                }
                
                // ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ
                setTimeout(() => {
                    effectOverlay.innerHTML = '';
                    treeDisplay.classList.remove('sick-effect', 'level-up-animation', 'tree-transition', 'pulse-glow', 'floating');
                }, 3000);
            }, 100);
        }

        function playSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                switch(type) {
                    case 'water':
                        playTone(audioContext, 400, 0.3, 0.2);
                        setTimeout(() => playTone(audioContext, 350, 0.2, 0.1), 200);
                        break;
                    case 'fertilizer':
                        playTone(audioContext, 600, 0.4, 0.15);
                        setTimeout(() => playTone(audioContext, 650, 0.3, 0.1), 300);
                        break;
                    case 'rain':
                        for(let i = 0; i < 8; i++) {
                            setTimeout(() => playTone(audioContext, 300 + Math.random() * 200, 0.1, 0.05), i * 150);
                        }
                        break;
                    case 'worm':
                        playTone(audioContext, 200, 0.5, 0.1);
                        setTimeout(() => playTone(audioContext, 180, 0.3, 0.08), 400);
                        break;
                    case 'sick':
                        playTone(audioContext, 150, 0.8, 0.08);
                        setTimeout(() => playTone(audioContext, 120, 0.5, 0.06), 600);
                        break;
                    case 'storm':
                        playTone(audioContext, 100, 1.2, 0.15);
                        setTimeout(() => playTone(audioContext, 80, 0.8, 0.1), 800);
                        break;
                    case 'win':
                        playTone(audioContext, 523, 0.3, 0.2); // C
                        setTimeout(() => playTone(audioContext, 659, 0.3, 0.2), 300); // E
                        setTimeout(() => playTone(audioContext, 784, 0.6, 0.25), 600); // G
                        break;
                    case 'levelup':
                        playTone(audioContext, 523, 0.2, 0.15); // C
                        setTimeout(() => playTone(audioContext, 659, 0.2, 0.15), 200); // E
                        setTimeout(() => playTone(audioContext, 784, 0.2, 0.15), 400); // G
                        setTimeout(() => playTone(audioContext, 1047, 0.4, 0.2), 600); // C high
                        break;
                    case 'spin':
                        for(let i = 0; i < 10; i++) {
                            setTimeout(() => playTone(audioContext, 200 + i * 20, 0.1, 0.05), i * 100);
                        }
                        break;
                    case 'winner':
                        playTone(audioContext, 659, 0.3, 0.2); // E
                        setTimeout(() => playTone(audioContext, 784, 0.3, 0.2), 200); // G
                        setTimeout(() => playTone(audioContext, 1047, 0.5, 0.25), 400); // C high
                        break;
                    case 'mission':
                        playTone(audioContext, 440, 0.2, 0.15); // A
                        setTimeout(() => playTone(audioContext, 554, 0.2, 0.15), 150); // C#
                        setTimeout(() => playTone(audioContext, 659, 0.3, 0.2), 300); // E
                        break;
                    case 'mission_complete':
                        playTone(audioContext, 523, 0.2, 0.2); // C
                        setTimeout(() => playTone(audioContext, 659, 0.2, 0.2), 200); // E
                        setTimeout(() => playTone(audioContext, 784, 0.2, 0.2), 400); // G
                        setTimeout(() => playTone(audioContext, 1047, 0.4, 0.25), 600); // C high
                        setTimeout(() => playTone(audioContext, 1319, 0.3, 0.2), 800); // E high
                        break;
                    case 'announcement':
                        playTone(audioContext, 880, 0.3, 0.15); // A high
                        setTimeout(() => playTone(audioContext, 784, 0.2, 0.12), 300); // G
                        setTimeout(() => playTone(audioContext, 659, 0.2, 0.1), 500); // E
                        break;
                    case 'tree_change':
                        playTone(audioContext, 440, 0.2, 0.15); // A
                        setTimeout(() => playTone(audioContext, 523, 0.2, 0.15), 200); // C
                        setTimeout(() => playTone(audioContext, 659, 0.2, 0.15), 400); // E
                        setTimeout(() => playTone(audioContext, 784, 0.3, 0.2), 600); // G
                        setTimeout(() => playTone(audioContext, 880, 0.3, 0.2), 800); // A high
                        break;
                }
            } catch(e) {
                console.log(`‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á ${type}`);
            }
        }
        
        function createSparkles() {
            const container = document.getElementById('effectOverlay');
            const colors = ['#FFD700', '#FFA500', '#FF69B4', '#00CED1', '#98FB98'];
            
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.style.position = 'absolute';
                    sparkle.style.width = '4px';
                    sparkle.style.height = '4px';
                    sparkle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    sparkle.style.borderRadius = '50%';
                    sparkle.style.left = Math.random() * 100 + '%';
                    sparkle.style.top = Math.random() * 100 + '%';
                    sparkle.style.pointerEvents = 'none';
                    sparkle.style.animation = 'sparkle 1.5s ease-out forwards';
                    sparkle.style.boxShadow = '0 0 6px currentColor';
                    container.appendChild(sparkle);
                    
                    setTimeout(() => {
                        if (sparkle.parentNode) {
                            sparkle.parentNode.removeChild(sparkle);
                        }
                    }, 1500);
                }, i * 100);
            }
        }
        
        function createNotificationEffect() {
            const container = document.getElementById('effectOverlay');
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏Ç‡∏¢‡∏≤‡∏¢
            const circle = document.createElement('div');
            circle.style.position = 'absolute';
            circle.style.top = '50%';
            circle.style.left = '50%';
            circle.style.width = '20px';
            circle.style.height = '20px';
            circle.style.borderRadius = '50%';
            circle.style.border = '3px solid #3B82F6';
            circle.style.transform = 'translate(-50%, -50%)';
            circle.style.animation = 'notificationRipple 1.5s ease-out forwards';
            circle.style.pointerEvents = 'none';
            container.appendChild(circle);
            
            setTimeout(() => {
                if (circle.parentNode) {
                    circle.parentNode.removeChild(circle);
                }
            }, 1500);
        }
        
        function createConfetti() {
            const container = document.getElementById('effectOverlay');
            const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'];
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti-particle';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    container.appendChild(confetti);
                    
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.parentNode.removeChild(confetti);
                        }
                    }, 2000);
                }, i * 50);
            }
        }

        function createTreeChangeEffect() {
            const container = document.getElementById('effectOverlay');
            const colors = ['#FF69B4', '#9370DB', '#00CED1', '#FFD700', '#FF6347'];
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏™‡∏µ‡∏£‡∏∏‡πâ‡∏á
            for (let i = 0; i < 12; i++) {
                setTimeout(() => {
                    const circle = document.createElement('div');
                    circle.style.position = 'absolute';
                    circle.style.width = '8px';
                    circle.style.height = '8px';
                    circle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    circle.style.borderRadius = '50%';
                    circle.style.left = '50%';
                    circle.style.top = '50%';
                    circle.style.pointerEvents = 'none';
                    circle.style.animation = 'sparkle 2s ease-out forwards';
                    circle.style.boxShadow = '0 0 10px currentColor';
                    
                    const angle = (Math.PI * 2 * i) / 12;
                    const distance = 60 + Math.random() * 40;
                    circle.style.transform = `translate(-50%, -50%) translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px)`;
                    
                    container.appendChild(circle);
                    
                    setTimeout(() => {
                        if (circle.parentNode) {
                            circle.parentNode.removeChild(circle);
                        }
                    }, 2000);
                }, i * 100);
            }
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ!"
            const text = document.createElement('div');
            text.style.position = 'absolute';
            text.style.top = '120%';
            text.style.left = '50%';
            text.style.transform = 'translateX(-50%)';
            text.style.color = '#9370DB';
            text.style.fontWeight = 'bold';
            text.style.fontSize = '16px';
            text.style.textShadow = '0 2px 4px rgba(0,0,0,0.3)';
            text.style.animation = 'float 2s ease-out';
            text.textContent = 'üé® ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ!';
            container.appendChild(text);
            
            setTimeout(() => {
                if (text.parentNode) {
                    text.parentNode.removeChild(text);
                }
            }, 2000);
        }

        function playTone(audioContext, frequency, duration, volume) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        function showSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
            updateSettingsUI();
        }
        
        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.add('hidden');
        }
        
        function updateSettingsUI() {
            const settings = gameData.settings;
            document.getElementById('soundToggle').textContent = settings.soundEnabled ? '‡πÄ‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î';
            document.getElementById('soundToggle').className = settings.soundEnabled ? 
                'bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-xl font-bold' :
                'bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-xl font-bold';
            
            document.getElementById('volumeSlider').value = settings.volume;
            
            document.getElementById('motionToggle').textContent = settings.reducedMotion ? '‡πÄ‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î';
            document.getElementById('motionToggle').className = settings.reducedMotion ? 
                'bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-xl font-bold' :
                'bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-xl font-bold';
            
            document.getElementById('fontSizeSelect').value = settings.fontSize;
            
            document.getElementById('contrastToggle').textContent = settings.highContrast ? '‡∏™‡∏π‡∏á' : '‡∏õ‡∏Å‡∏ï‡∏¥';
            document.getElementById('contrastToggle').className = settings.highContrast ? 
                'bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-xl font-bold' :
                'bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-xl font-bold';
        }
        
        function toggleSound() {
            gameData.settings.soundEnabled = !gameData.settings.soundEnabled;
            saveData();
            updateSettingsUI();
        }
        
        function toggleMotion() {
            gameData.settings.reducedMotion = !gameData.settings.reducedMotion;
            saveData();
            updateSettingsUI();
            applyMotionSettings();
        }
        
        function toggleContrast() {
            gameData.settings.highContrast = !gameData.settings.highContrast;
            saveData();
            updateSettingsUI();
            applyContrastSettings();
        }
        
        function applyMotionSettings() {
            if (gameData.settings.reducedMotion) {
                document.body.classList.add('reduced-motion');
            } else {
                document.body.classList.remove('reduced-motion');
            }
        }
        
        function applyContrastSettings() {
            if (gameData.settings.highContrast) {
                document.body.classList.add('high-contrast');
            } else {
                document.body.classList.remove('high-contrast');
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô View-as-Student
        function viewAsStudent(studentId) {
            const student = gameData.students.find(s => s.id == studentId);
            if (!student) return;
            
            const stage = getCurrentStage(student.points);
            const nextStage = getNextStage(student.points);
            
            document.getElementById('studentViewContent').innerHTML = `
                <div class="mb-6">
                    <h4 class="text-xl font-bold text-green-600 mb-2">${student.name}</h4>
                    <p class="text-gray-600">‡∏£‡∏´‡∏±‡∏™: ${student.code}</p>
                </div>
                
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-gray-700">${student.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
                        <span class="font-bold text-green-600">${nextStage ? `‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ${nextStage.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô` : '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß!'}</span>
                    </div>
                    <div class="bg-gray-200 rounded-full h-6 relative overflow-hidden">
                        <div class="progress-3d h-6 rounded-full transition-all duration-1000" style="width: ${nextStage ? ((student.points - stage.points) / (nextStage.points - stage.points)) * 100 : 100}%"></div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="text-8xl mb-4">${getTreeDisplay(student)}</div>
                    <div class="text-xl font-bold text-gray-800 mb-2">${stage.name}</div>
                    <div class="text-gray-600">${stage.description}</div>
                    ${student.treeType ? `<div class="text-blue-600 mt-2">‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ: ${treeTypes[student.treeType].name}</div>` : ''}
                </div>
                
                <div class="inline-block bg-gradient-to-r from-green-400 to-green-600 text-white px-6 py-2 rounded-full font-bold text-lg">
                    Lv.${treeStages.indexOf(stage) + 1}
                </div>
                
                ${student.garden && student.garden.length > 0 ? `
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h5 class="font-bold text-purple-600 mb-3">üè° ‡∏™‡∏ß‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ (${student.garden.length} ‡∏ï‡πâ‡∏ô)</h5>
                        <div class="grid grid-cols-3 md:grid-cols-4 gap-3">
                            ${student.garden.map(tree => {
                                const treeType = customTreeTypes[tree.type] || treeTypes[tree.type];
                                return `
                                    <div class="bg-purple-100 p-3 rounded-lg text-center">
                                        <div class="text-2xl mb-1">${treeType ? treeType.fruit : 'üå≥'}</div>
                                        <div class="text-xs text-purple-600 font-bold">${treeType ? treeType.name : '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ'}</div>
                                        <div class="text-xs text-gray-500">Lv.${tree.level}</div>
                                        <div class="text-xs text-green-600">${tree.finalPoints} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
            
            document.getElementById('viewAsStudentModal').classList.remove('hidden');
        }
        
        function closeViewAsStudentModal() {
            document.getElementById('viewAsStudentModal').classList.add('hidden');
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏´‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß
        if (gameData.currentUser?.type === 'teacher') {
            showTeacherDashboard();
        } else if (gameData.currentStudent) {
            showStudentDashboard();
        }
        
        // ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        applyMotionSettings();
        applyContrastSettings();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97494db460eb45c3',t:'MTc1NjEwNjE4Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
